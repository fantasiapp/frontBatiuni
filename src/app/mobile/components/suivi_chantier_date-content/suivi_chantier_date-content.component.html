<div class="chantier-tache-container" [ngClass]="{'suppression': date.deleted}">
    <div *ngIf="date.deleted" style="position: relative; top: 1rem;">
      <div class="details chantier-tache">
        <div class="detail-name"><span style="color: red;">Attention</span> : date en cours de suppression</div>
        <div class="controls" *ngIf="!mission!.isClosed">
          <img (click)="deleted(true, date.deleted)"  src= "assets/suivi-valider-OK.svg" #validateImg/>
          <img (click)="deleted(false, date.deleted)" src= "assets/suivi-refuser-OK.svg" #refuseImg/>
        </div>
      </div>
    </div>
    
    <div id="taskMain_{{date.id}}" *ngIf="view=='PME'">
        <div class="chantier-tache">
            <label>Choisir les tâches pour ce jour</label>
            <img (click)="swipeMenu = true" src="assets/Option.svg" *ngIf="!mission!.isClosed"/>
        </div>
    </div>
    <div class="taskByDate" *ngFor="let taskGraphic of tasksGraphic; let index = index">
        <div class="details chantier-tache">
          <span class="detail-name">{{ taskGraphic.selectedTask.content }}</span>
          <div class="controls" *ngIf="!mission!.isClosed">
            <img (click)="validate(taskGraphic.selectedTask, validateImg)" id="control_validate_{{taskGraphic.selectedTask.id}}" [src]= "taskGraphic.validationImage" #validateImg/>
            <img (click)="refuse(taskGraphic.selectedTask, refuseImg)" id="control_refuse_{{taskGraphic.selectedTask.id}}" [src]= "taskGraphic.invalidationImage" #refuseImg/>
          </div>
        </div>
        <!-- <div class="comment-container">
          <div *ngIf="!mission!.isClosed && !taskGraphic.selectedTask.supervisions.length" class="divComment">
            <form (click)="slideComment(taskGraphic, $event, taskGraphic.selectedTask.supervisions, taskGraphic.selectedTask)" [formGroup]="taskGraphic.formGroup" (ngSubmit)="onSubmit(taskGraphic.selectedTask, taskGraphic.formGroup, 'comment')">
              <input style="pointer-events: none;" id="input_{{taskGraphic.selectedTask.id}}" class="inputComment" type="text" placeholder="Ajouter un commentaire" formControlName="comment"  #comment>
            </form>
          </div>
        </div> -->
        <div class="comment-container" *ngFor="let supervision of taskGraphic.selectedTask.supervisions">
          <comment-suivi  *ngIf="taskGraphic.selectedTask.supervisions.length"  [supervision]="supervision"></comment-suivi>
        </div>
        <div *ngIf="!mission!.isClosed" (click)="slideComment(taskGraphic, $event, taskGraphic.selectedTask.supervisions, taskGraphic.selectedTask)" class="comment-action-box comment-action-box-task">
          <span>Commenter
          </span>
          <svg class="comment-action-box-img" xmlns="http://www.w3.org/2000/svg" width="20.882" height="19.026" viewBox="0 0 20.882 19.026">
            <path id="Path_45441" data-name="Path 45441" d="M99.624,67.008a1.641,1.641,0,0,0-1.175.457A1.665,1.665,0,0,0,98,68.633v9.285a1.643,1.643,0,0,0,.45,1.161,1.684,1.684,0,0,0,1.16.464h.711V82.56a.7.7,0,0,0,1.175.5l3.734-3.518h9.244a1.564,1.564,0,0,0,1.624-1.625V68.633a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457H99.624Zm0,1.393h14.849c.141,0,.173.028.189.044s.044.054.044.189v9.285c0,.135-.028.165-.044.181s-.047.051-.189.051h-9.513a.706.706,0,0,0-.479.189l-2.77,2.611v-2.1a.724.724,0,0,0-.7-.7H99.624a.28.28,0,0,1-.189-.058c-.016-.016-.044-.039-.044-.174V68.633c0-.135.028-.173.044-.189s.047-.044.189-.044Zm11.3.464a.7.7,0,0,0,.073,1.393h1.624c.141,0,.173.028.189.044s.044.054.044.189v3.482a.7.7,0,1,0,1.392,0V70.49a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457h-1.7Zm7.251,2.539a.724.724,0,0,0-.682.711V80.7c0,.136-.028.159-.044.174s-.053.052-.21.058h-1.6a.724.724,0,0,0-.7.7v2.1l-2.77-2.611a.7.7,0,0,0-.479-.189h-6.033a.7.7,0,1,0,0,1.393h5.764l3.734,3.518a.7.7,0,0,0,1.175-.5V82.328h.95a1.714,1.714,0,0,0,1.153-.471,1.627,1.627,0,0,0,.45-1.153V72.115a.724.724,0,0,0-.71-.711Z" transform="translate(-98 -67.008)"/>
          </svg>          
        </div>
    </div>
    

    <div class="partenerComment-container" [ngClass]="{'empty-main-comment': !date.supervisions.length}">
      <div>
          <h2>Communiquer avec votre partenaire de chantier</h2>
          <div *ngFor="let supervision of date.supervisions; let isLast = last">
            <comment-suivi  [supervision]="supervision" #commentSuivi></comment-suivi>
          </div>
          <div *ngIf="!mission!.isClosed" (click)="slideComment(null, $event, date.supervisions, null)" class="comment-action-box comment-action-box-main">
            <span>Afficher toute la conversation
            </span>
            <svg class="comment-action-box-img" xmlns="http://www.w3.org/2000/svg" width="20.882" height="19.026" viewBox="0 0 20.882 19.026">
              <path id="Path_45441" data-name="Path 45441" d="M99.624,67.008a1.641,1.641,0,0,0-1.175.457A1.665,1.665,0,0,0,98,68.633v9.285a1.643,1.643,0,0,0,.45,1.161,1.684,1.684,0,0,0,1.16.464h.711V82.56a.7.7,0,0,0,1.175.5l3.734-3.518h9.244a1.564,1.564,0,0,0,1.624-1.625V68.633a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457H99.624Zm0,1.393h14.849c.141,0,.173.028.189.044s.044.054.044.189v9.285c0,.135-.028.165-.044.181s-.047.051-.189.051h-9.513a.706.706,0,0,0-.479.189l-2.77,2.611v-2.1a.724.724,0,0,0-.7-.7H99.624a.28.28,0,0,1-.189-.058c-.016-.016-.044-.039-.044-.174V68.633c0-.135.028-.173.044-.189s.047-.044.189-.044Zm11.3.464a.7.7,0,0,0,.073,1.393h1.624c.141,0,.173.028.189.044s.044.054.044.189v3.482a.7.7,0,1,0,1.392,0V70.49a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457h-1.7Zm7.251,2.539a.724.724,0,0,0-.682.711V80.7c0,.136-.028.159-.044.174s-.053.052-.21.058h-1.6a.724.724,0,0,0-.7.7v2.1l-2.77-2.611a.7.7,0,0,0-.479-.189h-6.033a.7.7,0,1,0,0,1.393h5.764l3.734,3.518a.7.7,0,0,0,1.175-.5V82.328h.95a1.714,1.714,0,0,0,1.153-.471,1.627,1.627,0,0,0,.45-1.153V72.115a.724.724,0,0,0-.71-.711Z" transform="translate(-98 -67.008)"/>
            </svg>          
          </div>
      </div>
    </div>
</div>

<slidemenu [(open)]="slideCommentMenu.slideCommentOpen" #slideMenuComment>
  <h1 class="center-text full-width" header>Commentaires</h1>

  <app-supervision-wrapper *ngIf="slideCommentMenu.slideCommentOpen" [taskGraphic]="slideCommentMenu.taskGraphic" [selectedTask]="slideCommentMenu.selectedTask" [mission]="mission!" [dateOrigin]="dateOrigin!" [supervisions]="slideCommentMenu.supervisions" (closeSwipe)="refreshMainComment($event)" content></app-supervision-wrapper>
</slidemenu>


<swipeup [(open)]="swipeMenu">
    <li (click)="addTaskToPost()"> Modifier les tâches</li>
</swipeup>

<swipeup [(open)]="swipeMenuImage" #modifyPicture>
    <li (click)="takePhoto()">Accéder à l'appareil photo</li>
    <li (click)="selectPhoto()">Télécharger une image</li>
</swipeup>