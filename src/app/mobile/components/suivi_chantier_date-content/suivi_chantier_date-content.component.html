<div class="chantier-tache-container" [ngClass]="{'suppression': date.deleted}">
    <div *ngIf="date.deleted" style="position: relative; top: 1rem;">
      <div class="details chantier-tache">
        <div class="detail-name"><span style="color: red;">Attention</span> : date en cours de suppression</div>
        <div class="controls" *ngIf="!mission!.isClosed">
          <img (click)="deleted(true, date.deleted)"  src= "assets/suivi-valider-OK.svg" #validateImg/>
          <img (click)="deleted(false, date.deleted)" src= "assets/suivi-refuser-OK.svg" #refuseImg/>
        </div>
      </div>
    </div>
    
    <div id="task-manager" *ngIf="view=='PME'; else taskViewerST">
        <div class="chantier-tache">
          <label (click)="taskManager($event, true)">Choisir les tâches pour ce jour 
            <svg id="noun_add_928257" xmlns="http://www.w3.org/2000/svg" width="22.721" height="22.721" viewBox="0 0 22.721 22.721"  class="add-task-img">
              <g id="Group_280" data-name="Group 280" transform="translate(0)">
                <path fill="currentColor" id="Path_299" data-name="Path 299" d="M11.361,0A11.361,11.361,0,1,0,22.721,11.361,11.361,11.361,0,0,0,11.361,0Zm0,4.279c.153,0,.5.123.5.277v6.306h6.306c.153,0,.277.345.277.5s-.123.5-.277.5H11.859v6.306c0,.153-.345.277-.5.277s-.5-.123-.5-.277V11.859H4.556c-.153,0-.277-.345-.277-.5s.123-.5.277-.5h6.306V4.556C10.86,4.4,11.207,4.279,11.361,4.279Z" transform="translate(0)"/>
              </g>
            </svg>
          </label>
          <form *ngIf="!mission!.isClosed && taskMenuUp" #formTask>
            <input id="addTask" type="text" autocomplete="off" placeholder="Ajouter une nouvelle tâche" #addTask>
            <img class="task-menu__arrow-task" src="assets/arrowdown.svg" [ngClass]="{'active': taskMenuUp}"/>
            <div class="task-menu__wrapper">
              <ul id="list-date">
                <li *ngFor="let detailedPost of date.allPostDetails" 
                (click)="addDetailedPostPending(detailedPost, checkbox, $event)" 
                [ngClass]="{'disabled': detailedPost.checked}">
                  <span >{{ detailedPost.content }}</span>
                  <checkbox style="pointer-events: none; flex-shrink: 0;" [value]="detailedPost.checked || checkbox.value" #checkbox></checkbox>
                </li>
              </ul>
              <div class="task-menu__action_container">
                <button class="button passive" (click)="slideNewTaskManager = true">Ajouter une tache</button>
                <button class="button active" (click)="computeValidateTask()">Valider</button>
              </div>
            </div>
          </form>
          <div class="full-page" style="left: 0; position: absolute" (click)="taskManager($event, false)" *ngIf="taskMenuUp"></div>
          </div>
    </div>
    <ng-template #taskViewerST >
      <div id="task-manager" *ngIf="tasksGraphic.length">
          Les taches du jours : <span *ngFor="let task of tasksGraphic; let isLast = last">{{ task.selectedTask.content }}<ng-container>{{ isLast ? '.' : ', '}}</ng-container></span>
      </div>
    </ng-template>
    <div class="taskByDate" *ngFor="let taskGraphic of tasksGraphic; let index = index">
        <div class="details chantier-tache">
          <span class="detail-name">{{ taskGraphic.selectedTask.content }}</span>
          <div class="controls" *ngIf="!mission!.isClosed">
            <img (click)="validate(taskGraphic.selectedTask, validateImg)" id="control_validate_{{taskGraphic.selectedTask.id}}" [src]= "taskGraphic.validationImage" #validateImg/>
            <img (click)="refuse(taskGraphic.selectedTask, refuseImg)" id="control_refuse_{{taskGraphic.selectedTask.id}}" [src]= "taskGraphic.invalidationImage" #refuseImg/>
          </div>
        </div>

        <div class="comment-container" *ngFor="let supervision of taskGraphic.selectedTask.supervisions">
          <comment-suivi  *ngIf="taskGraphic.selectedTask.supervisions.length"  [supervision]="supervision"></comment-suivi>
        </div>
        <div *ngIf="!mission!.isClosed" (click)="slideComment(taskGraphic, $event, taskGraphic.selectedTask.supervisions, taskGraphic.selectedTask)" class="comment-action-box comment-action-box-task">
          <span>Ajouter une photo ou un commentaire
          </span>
          <!-- <svg class="comment-action-box-img" xmlns="http://www.w3.org/2000/svg" width="20.882" height="19.026" viewBox="0 0 20.882 19.026">
            <path id="Path_45441" data-name="Path 45441" d="M99.624,67.008a1.641,1.641,0,0,0-1.175.457A1.665,1.665,0,0,0,98,68.633v9.285a1.643,1.643,0,0,0,.45,1.161,1.684,1.684,0,0,0,1.16.464h.711V82.56a.7.7,0,0,0,1.175.5l3.734-3.518h9.244a1.564,1.564,0,0,0,1.624-1.625V68.633a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457H99.624Zm0,1.393h14.849c.141,0,.173.028.189.044s.044.054.044.189v9.285c0,.135-.028.165-.044.181s-.047.051-.189.051h-9.513a.706.706,0,0,0-.479.189l-2.77,2.611v-2.1a.724.724,0,0,0-.7-.7H99.624a.28.28,0,0,1-.189-.058c-.016-.016-.044-.039-.044-.174V68.633c0-.135.028-.173.044-.189s.047-.044.189-.044Zm11.3.464a.7.7,0,0,0,.073,1.393h1.624c.141,0,.173.028.189.044s.044.054.044.189v3.482a.7.7,0,1,0,1.392,0V70.49a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457h-1.7Zm7.251,2.539a.724.724,0,0,0-.682.711V80.7c0,.136-.028.159-.044.174s-.053.052-.21.058h-1.6a.724.724,0,0,0-.7.7v2.1l-2.77-2.611a.7.7,0,0,0-.479-.189h-6.033a.7.7,0,1,0,0,1.393h5.764l3.734,3.518a.7.7,0,0,0,1.175-.5V82.328h.95a1.714,1.714,0,0,0,1.153-.471,1.627,1.627,0,0,0,.45-1.153V72.115a.724.724,0,0,0-.71-.711Z" transform="translate(-98 -67.008)"/>
          </svg>           -->
        </div>
    </div>
    

    <div class="partenerComment-container" [ngClass]="{'empty-main-comment': !date.supervisions.length, 'empty-task': !tasksGraphic.length}">
      <div>
          <h2>Communiquer avec votre partenaire de chantier</h2>
          <div *ngFor="let supervision of date.supervisions; let isLast = last">
            <comment-suivi  [supervision]="supervision" #commentSuivi></comment-suivi>
          </div>
          <div *ngIf="!mission!.isClosed" (click)="slideComment(null, $event, date.supervisions, null)" class="comment-action-box comment-action-box-task">
            <span>Ajouter une photo ou un commentaire
            </span>
            <!-- <svg class="comment-action-box-img" xmlns="http://www.w3.org/2000/svg" width="20.882" height="19.026" viewBox="0 0 20.882 19.026">
              <path id="Path_45441" data-name="Path 45441" d="M99.624,67.008a1.641,1.641,0,0,0-1.175.457A1.665,1.665,0,0,0,98,68.633v9.285a1.643,1.643,0,0,0,.45,1.161,1.684,1.684,0,0,0,1.16.464h.711V82.56a.7.7,0,0,0,1.175.5l3.734-3.518h9.244a1.564,1.564,0,0,0,1.624-1.625V68.633a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457H99.624Zm0,1.393h14.849c.141,0,.173.028.189.044s.044.054.044.189v9.285c0,.135-.028.165-.044.181s-.047.051-.189.051h-9.513a.706.706,0,0,0-.479.189l-2.77,2.611v-2.1a.724.724,0,0,0-.7-.7H99.624a.28.28,0,0,1-.189-.058c-.016-.016-.044-.039-.044-.174V68.633c0-.135.028-.173.044-.189s.047-.044.189-.044Zm11.3.464a.7.7,0,0,0,.073,1.393h1.624c.141,0,.173.028.189.044s.044.054.044.189v3.482a.7.7,0,1,0,1.392,0V70.49a1.665,1.665,0,0,0-.45-1.168,1.64,1.64,0,0,0-1.175-.457h-1.7Zm7.251,2.539a.724.724,0,0,0-.682.711V80.7c0,.136-.028.159-.044.174s-.053.052-.21.058h-1.6a.724.724,0,0,0-.7.7v2.1l-2.77-2.611a.7.7,0,0,0-.479-.189h-6.033a.7.7,0,1,0,0,1.393h5.764l3.734,3.518a.7.7,0,0,0,1.175-.5V82.328h.95a1.714,1.714,0,0,0,1.153-.471,1.627,1.627,0,0,0,.45-1.153V72.115a.724.724,0,0,0-.71-.711Z" transform="translate(-98 -67.008)"/>
            </svg>           -->
          </div>
      </div>
    </div>
</div>

<slidemenu [(open)]="slideCommentMenu.slideCommentOpen" #slideMenuComment>
  <h1 class="center-text grow" header>{{ view == 'PME' ? mission?.subContractorName : mission?.contactName}}</h1>

  <app-supervision-wrapper *ngIf="slideCommentMenu.slideCommentOpen" [taskGraphic]="slideCommentMenu.taskGraphic" [selectedTask]="slideCommentMenu.selectedTask" [mission]="mission!" [dateOrigin]="dateOrigin!" [supervisions]="slideCommentMenu.supervisions" (closeSwipe)="refreshMainComment($event)" content></app-supervision-wrapper>
</slidemenu>
<slidemenu [(open)]="slideNewTaskManager" #slideNewTask>
  <h1 class="center-text full-width" header>Ajouter des tâches</h1>

  <task-add (validateEmiter)="computeNewTasks($event)" *ngIf="slideNewTaskManager" content></task-add>  
</slidemenu>

<swipeup [(open)]="swipeMenuImage" #modifyPicture>
    <li (click)="takePhoto()">Accéder à l'appareil photo</li>
    <li (click)="selectPhoto()">Télécharger une image</li>
</swipeup>