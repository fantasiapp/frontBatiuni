<ng-container *ngIf="(user$ | async) as user">
  <page-header [name]="user.viewType ? 'Mes Annonces' : 'Annonces qui peuvent vous intéresser'" [tabs]="user.viewType ? 3 : 2" [(activeView)]="activeView" (filterClicked)="openAdFilterMenu = true">
    <span tab_0>{{ user.viewType ? 'Brouillon' : 'Vue liste' }}</span>
    <span tab_1>{{ user.viewType ? 'En ligne' : 'Carte' }}</span>
    <span tab_2>Validées</span>
  </page-header>
  
  <div class="hosted-page space-children-margin page-content-with-tabs">
    <!-- Page pour PME -->
    <ng-container *ngIf="user.viewType; else stview">
      <ng-container *ngIf="(posts$ | async) as posts" [ngSwitch]="activeView">
        <ng-container *ngSwitchCase="0">
          <offer
            *ngFor="let draft of userDrafts"
            src="assets/brouillon.svg"
            [deletable]="true"
            [post]="draft"
            (click)="openPost(draft)"
            ></offer> 
        </ng-container>
        <ng-container *ngSwitchCase="1">
          <offer
            *ngFor="let onlinePost of userOnlinePosts"
            src="assets/enligne.svg"
            [deletable]="false"
            [post]="onlinePost"
            (click)="checkPost(onlinePost)"
            ></offer>
        </ng-container>
        <ng-container *ngSwitchCase="2">
          <offer
            *ngFor="let mission of annonces"
            src="assets/validée.svg"
            [routerLink]="['', 'annonce-validee']"></offer>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- Page pour ST -->
    <ng-template #stview>
      <ng-container [ngSwitch]="activeView">
        <ng-container *ngSwitchCase="0">
          <offer
            *ngFor="let pair of allOnlinePosts"
            [deletable]="false"
            src="assets/enligne.svg"
            [post]="pair[0]"
            (click)="checkPost(pair[0])"
            ></offer>
        </ng-container>
        <mapbox-batiuni class="space-children-margin" *ngSwitchCase="1"></mapbox-batiuni>
      </ng-container>
    </ng-template>
  </div>
  
  <swipeup [(open)]="openAdFilterMenu" type="view">
    <pme-filter-form [activeView]="activeView" *ngIf="user.viewType; else stfilter" view></pme-filter-form>
    <ng-template #stfilter><st-filter-form></st-filter-form></ng-template>
  </swipeup>
  
  <slidemenu [(open)]="editMenu.open" [header]="true">
    <span class="grow center-text text-light-emphasis" header>Modifier un brouillon</span>
    
    <div class="hosted-page flex column center-cross space-children-margin" content>
      <ad-form [post]="editMenu.post" [page]="false" content></ad-form>
    </div>
  </slidemenu>

  <slidemenu [(open)]="checkMenu.open" [header]="false" #slideOnlinePost>
    <header class="clear-margin full-width sticky-header flex center-cross annonce" customHeader>
      <img (click)="slideOnlinePost.close()" src="assets/arrowlblack.svg" />
      <span class="grow center-text text-light-emphasis">Annonce en Ligne</span>
      <img (click)="checkPostMenu()" src="assets/Option.svg" />
    </header>

    <ng-container content>
      <annonce-resume class="hosted-page" [collapsed]="false" [post]="checkMenu.post!"></annonce-resume>

      <swipeup [(open)]="checkMenu.swipeup">
        <li data-notification-number="2" class="notification">Afficher les réponses</li>
        <li [routerLink]="['','booster']">Booster Mon annonce</li>
        <li (click)="deletePost(checkMenu.post!.id)">Supprimer l'annonce</li>
        <li (click)="duplicatePost(checkMenu.post!.id)">Duppliquer l'annonce</li>
        <li (click)="switchDraft(checkMenu.post!.id)">Mettre en pause l'annonce</li>
      </swipeup>
    </ng-container>    
  </slidemenu>
  <!-- Maybe slide menu should hide their content when they are not open ?? -->
</ng-container>