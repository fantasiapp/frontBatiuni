<ng-container *ngIf="(user$ | async) as user">
  <page-header [name]="user.viewType ? 'Mes Annonces' : 'Annonces qui peuvent vous intéresser'" [tabs]="user.viewType ? 3 : 2" [(activeView)]="activeView" (filterClicked)="openAdFilterMenu = true">
    <span tab_0>{{ user.viewType ? 'Brouillon' : 'Vue liste' }}</span>
    <span tab_1>{{ user.viewType ? 'En ligne' : 'Carte' }}</span>
    <span tab_2>Validées</span>
  </page-header>
  
  <div class="hosted-page space-children-margin page-content-with-tabs">
    <!-- Page pour PME -->
    <ng-container *ngIf="user.viewType; else stview">
      <ng-container *ngIf="(posts$ | async) as posts" [ngSwitch]="activeView">
        <ng-container *ngSwitchCase="0">
          <offer
            *ngFor="let draft of userDrafts"
            src="assets/brouillon.svg"
            [deletable]="true"
            [post]="draft"
            (click)="openPost(draft)"
            ></offer> 
        </ng-container>
        <ng-container *ngSwitchCase="1">
          <offer
            *ngFor="let onlinePost of userOnlinePosts"
            src="assets/enligne.svg"
            [deletable]="false"
            [post]="onlinePost"
            (click)="checkPost(onlinePost)"
            ></offer>
        </ng-container>
        <ng-container *ngSwitchCase="2">
          <offer
            *ngFor="let mission of annonces"
            src="assets/validée.svg"
            [routerLink]="['', 'annonce-validee']"></offer>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- Page pour ST -->
    <ng-template #stview>
      <ng-container [ngSwitch]="activeView">
        <ng-container *ngSwitchCase="0">
          <offer
            *ngFor="let onlinePost of allOnlinePosts"
            [deletable]="false"
            src="assets/enligne.svg"
            [post]="onlinePost"
            (click)="checkPost(onlinePost)"
            ></offer>
        </ng-container>
        <mapbox-batiuni [posts]="allOnlinePosts" class="space-children-margin" *ngSwitchCase="1" (postClick)="checkPost($event)"></mapbox-batiuni>
      </ng-container>
    </ng-template>
  </div>
  
  <swipeup [(open)]="openAdFilterMenu" type="view">
    <pme-filter-form [activeView]="activeView" *ngIf="user.viewType; else stfilter" view></pme-filter-form>
    <ng-template #stfilter><st-filter-form></st-filter-form></ng-template>
  </swipeup>
  
  <slidemenu [(open)]="editMenu.open" [header]="true">
    <span class="grow center-text text-light-emphasis" header>Modifier un brouillon</span>
    
    <div class="hosted-page flex column center-cross space-children-margin" content>
      <ad-form [post]="editMenu.post" (done)="editMenu = {open: false, post: null}" [page]="false" content></ad-form>
    </div>
  </slidemenu>


  <slidemenu [open]="false" [header]="false" #reponse>
      <header class="clear-margin full-width sticky-header flex center-cross annonce" customHeader>
        <img (click)="reponse.close()" src="assets/arrowlblack.svg" />

        <span class="grow center-text text-light-emphasis">Annonce en Ligne</span>
      </header>
  
      <ng-container content>

        <div class="space-children-margin page-content-without-nav hosted-page flex  center-cross column candidature">
          <profile-resume [switch]="false"class="flex column center-cross space-children-margin " [user]="user" >
            <span>
              <span class="text-light-emphasis">Montant proposé : </span> <span
                class="value">0,00$</span>
            </span>
          </profile-resume>
          
          <section class="job-description full-width flex column space-children-margin">
            <span>
              <span class="text-light-emphasis">Nom de l'entreprise : </span> <span
                class="value">{{user.profile!.company.name}}</span>
            </span>
            <span>
              <span class="text-light-emphasis">N SIRET : </span> <span
                class="value">{{user.profile!.company.siret}}</span>
            </span>
            <span>
              <span class="text-light-emphasis">Métier : </span>
              <span *ngFor="let job of user.profile!.company.jobs!" class="value">{{ job.number }} {{ job.job.name }}, </span>
            </span>
            <span>
              <span class="text-light-emphasis">Chiffres d'affaires : </span>
              <span class="value">{{user.profile!.company.revenue | currency: 'EUR':'symbol':'1.0-0' }}</span>
            </span>
          
            <span>
              <span class="text-light-emphasis">Numéro fixe : </span>
              <span class="value">{{user.profile!.company.companyPhone | space: 2:1 }}</span>
            </span>
           
          </section>
          <hr class="dashed">
          <section class="">
            <h4>Documents importants</h4>
            
          </section>
          <hr class="dashed">
          <section class="contact-user full-width space-children-margin">
            <h4>Contact</h4>
            <div class="flex space-between">
              <li><img src="assets/phone.png"/></li>
            <li><img src="assets/phone.png"/></li>
            <li><img src="assets/phone.png"/></li>
            </div>
          </section>

        </div>
        <footer class="clear-margin full-width sticky-footer flex center-text center reponse-footer">
          <button class="button active reponse-footer-button" (click)="openReponseMenu = true" > Passer la commande</button>
      </footer>
      </ng-container>
  </slidemenu>
  <slidemenu [(open)]="checkMenu.open" [header]="false" #slideOnlinePost>
    <header class="clear-margin full-width sticky-header flex center-cross annonce" customHeader>
      <img (click)="slideOnlinePost.close()" src="assets/arrowlblack.svg" />
      <span class="grow center-text text-light-emphasis">Annonce en Ligne</span>
      <img (click)="checkPostMenu()" src="assets/Option.svg" />
    </header>

    <ng-container content>
      <annonce-resume class="hosted-page" [collapsed]="false" [post]="checkMenu.post!"></annonce-resume>

      <swipeup [(open)]="checkMenu.swipeup">
        <li data-notification-number="2" class="notification">Afficher les réponses</li>
        <li [routerLink]="['','booster']">Booster Mon annonce</li>
        <li (click)="deletePost(checkMenu.post!.id)">Supprimer l'annonce</li>
        <li (click)="duplicatePost(checkMenu.post!.id)">Dupliquer l'annonce</li>
        <li (click)="pausePost(checkMenu.post!.id)">Mettre en pause l'annonce</li>
      </swipeup>
    </ng-container>    
  </slidemenu>
  <!-- Maybe slide menu should hide their content when they are not open ?? -->
  <swipeup [(open)]="openReponseMenu">
    <li class="flex center-cross" (click)="showUserOffer()"><img src="a " />Valider la candidature</li>
    <li class="flex center-cross"><img src="a " />Refuser la candidature</li>
    <li class="flex center-cross"><img src=" a" />Bloquer le contact</li>
  </swipeup>


  
</ng-container>

<!-- </ng-container> -->

<ng-template #pausePostTemplate>
  <img src="assets/pause.svg">
  <p>Votre annonce a bien été mise en pause</p>
  <p>Vous pouvez toujours l'accéder à partir de vos brouillons.</p>
</ng-template>
<ng-template #acceptOffer let-user>
  <div class="offres-logo"><img src="assets/validée.svg"/>
  
  </div>
  <p>Vous avez bien validé la candidature de 
    <br> 
    <span class="text-emphasis">{{ (user.profile!.firstName + " " + user.profile!.lastName) | titlecase }} </span><br>Veuillez 
    confirmer votre opération pour recevoir le contrat !
  </p>
  <div class="flex column space-children-margin full-width">
    <button class="button active">Valider</button>
    <button class="button passive">Annuler</button>
  </div>
</ng-template>