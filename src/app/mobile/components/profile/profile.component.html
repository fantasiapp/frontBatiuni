<!--Configure role accordingly-->
<ng-container *ngIf="(user$ | async) as user">
  <header class="clear-margin full-width sticky-header flex center-cross">
    <span class="grow text-light-emphasis">Mon Profil</span>
    <img src="assets/notification.svg" (click)="openNotifications = true" />
    <img src="assets/menu.svg" (click)="openMenu = true" />
  </header>

  <div class="hosted-page flex column center-cross space-children-margin page-content font-Poppins">
    <profile-resume class="flex column center-cross space-children-margin" [showMore]="true" (ratingsClicked)="openRatings = true" (profileChanged)="changeProfileType($event)" [user]="user"></profile-resume>

    <section class="job-description full-width flex column space-children-margin">
      <span>
        <span class="text-light-emphasis">Nom de l'entreprise : </span> <span
          class="value">{{user.profile!.company.name}}</span>
      </span>
      <span>
        <span class="text-light-emphasis">N SIRET : </span> <span
          class="value">{{user.profile!.company.siret}}</span>
      </span>
      <span>
        <span class="text-light-emphasis">Métier : </span>
        <span *ngFor="let job of user.profile!.company.jobs!" class="value">{{ job.number }} {{ job.job.name }}, </span>
      </span>
      <span>
        <span class="text-light-emphasis">Chiffres d'affaires : </span>
        <span class="value">{{user.profile!.company.revenue | currency: 'EUR':'symbol':'1.0-0' }}</span>
      </span>
      <span>
        <span class="text-light-emphasis">Capital : </span>
        <span class="value">{{user.profile!.company.capital | currency: 'EUR':'symbol':'1.0-0' }}</span>
      </span>
      <span>
        <span class="text-light-emphasis">Numéro fixe : </span>
        <span class="value">{{user.profile!.company.companyPhone | space: 2:1 }}</span>
      </span>
      <span>
        <span class="text-light-emphasis">Site internet : </span>
        <span class="value link"><a [href]="user.profile!.company.webSite">{{user.profile!.company.webSite}}</a></span>
      </span>
    </section>

    <section class="documents">
      <h4>Documents importants</h4>
      <div class="flex images">
        <file-svg *ngFor="let file of attachedFiles" name="file.name" color="getFileColor(file.name)" (click)="openFile(file.name)"></file-svg>
      </div>
    </section>
  </div>

  <swipeup [(open)]="openMenu">
    <li (click)="slideModifyMenu(false)">Modifier mon profil</li>
    <li (click)="slideModifyMenu(true)">Modifier mon mot de passe</li>
    <li>Candidatures en cours</li>
    <li [routerLink]="['','abonnement']">Gérer mes abonnements</li>
    <li [routerLink]="['','factures']">Mes factures</li>
    <li>Partager l'application</li>
    <li>Noter l'application</li>
    <li>Nous contacter</li>
    <li>FAQ</li>
    <li>Mentions légales</li>
    <li (click)="logout()">Se déconnecter</li>
  </swipeup>

  <slidemenu [(open)]="openModifyMenu" #modifyMenu>    
    <div class="full-width center-text text-emphasis" header>Modifier mon Profil</div>
    <div class="modify-page hosted-page flex column center-cross space-children-margin" content>
      <swipeup [(open)]="openModifyPicture" #modifyPicture>
        <li (click)="takePhoto()">Accédez à l'appareil photo</li>
        <li (click)="selectPhoto()">Télécharger une image</li>
      </swipeup>

      <section class="section">
        <profile-image [user]="user"></profile-image>
        <img src="assets/icons/modify.svg" class="modify-icon image" (click)="swipeModifyPicture()"/>
      </section>
  
      <switch off="Profile ST" on="Profil PME"  style="text-align: center;" off="Profil ST" on="Profil PME" [value]="user.viewType" disabled></switch>
      <stars value="3.9"></stars>
  
      <div class="form-container full-width grow flex column position-relative">
        <modify-password-form *ngIf="modifyPassword" class="grow"></modify-password-form>
        <modify-profile-form [user]="user.profile!" *ngIf="!modifyPassword" class="grow" (submit)="modifyProfile($event)" (openFile)="openFile($event)" #modifyForm></modify-profile-form>
      </div>
    </div>
  </slidemenu>

  <slidemenu [(open)]="openRatings">
    <div class="full-width center-text text-emphasis" header>Mes notes</div>
    <div class="hosted-page flex column center-cross space-children-margin" content>

      <profile-image [user]="user"></profile-image>
      <switch off="Profile ST" on="Profil PME" style="text-align: center;"></switch>

      <stars value="3.9"></stars>
      <span class="full-width section " style="text-align: center;font-size: 12px; margin-bottom: 10px;">Demander une
        recommandation</span>
      <section class="full-width section modify-profile">
        <div class="company-rate">
          <span class="company-name">SARL</span>
          <div class="criterion ">
            <div class="flex center-cross">
              <span class="criterion-stars">CRITERE 1
              </span>
              <stars class="stars" value="3.9"></stars>
            </div>

            <span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
              et dolore</span>

          </div>
          <div class="criterion ">
            <div class="flex center-cross">
              <span class="criterion-stars">CRITERE 1
              </span>
              <stars class="stars" value="3.9"></stars>
            </div>

            <span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
              et dolore</span>

          </div>
          <div class="criterion ">
            <div class="flex center-cross">
              <span class="criterion-stars">CRITERE 1
              </span>
              <stars class="stars" value="3.9"></stars>
            </div>

            <span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
              et dolore</span>
          </div>
        </div>
        <div class="company-rate">
          <span class="company-name">SARL</span>
          <div class="criterion ">
            <div class="flex center-cross">
              <span class="criterion-stars">CRITERE 1
              </span>
              <stars class="stars" value="3.9"></stars>
            </div>

            <span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
              et dolore</span>

          </div>
          <div class="criterion ">
            <div class="flex center-cross">
              <span class="criterion-stars">CRITERE 1
              </span>
              <stars class="stars" value="3.9"></stars>
            </div>

            <span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
              et dolore</span>

          </div>
          <div class="criterion ">
            <div class="flex center-cross">
              <span class="criterion-stars">CRITERE 1
              </span>
              <stars class="stars" value="3.9"></stars>
            </div>

            <span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
              et dolore</span>
          </div>
        </div>
      </section>
    </div>
  </slidemenu>
  <slidemenu [(open)]="openNotifications">
    <div class="full-width center-text text-emphasis" header>Notifications</div>
    <notifications class="hosted-page flex column center-cross space-children-margin" content></notifications>
  </slidemenu>
</ng-container>

<popup [(open)]="fileView.open">
  <ng-container *ngIf="fileView.safeUrl">
    <img class="embedded-image" *ngIf="fileView.image; else objectTag" [src]="fileView.safeUrl"/>
    <ng-template #objectTag>
      <object class="embedded-object cover-parent flex center" [type]="fileView.type" [attr.data]="fileView.safeUrl">
        <div>
          Ne peut pas afficher le PDF dans l'application
          <div class="external-links" (click)="openWindow(fileView.url)">
            Ouvrir le PDF localement.
          </div>
        </div>
      </object>
    </ng-template>
  </ng-container>
</popup>

<info></info>