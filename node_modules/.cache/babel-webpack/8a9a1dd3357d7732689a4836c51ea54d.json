{"ast":null,"code":"import _asyncToGenerator from \"/Users/jlw/Documents/frontBatiuni/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Destroy$ } from \"src/app/shared/common/classes\";\nimport { DataQueries, DataState } from \"src/models/new/data.state\";\nimport { take } from \"rxjs/operators\";\nimport { ModifyDetailedPost, CreateSupervision, CreateDetailedPost, UploadImageSupervision } from \"src/models/new/user/user.actions\";\nimport { SuiviPME } from \"../suivi_pme/suivi-pme.page\";\nimport { Camera, CameraResultType, CameraSource } from \"@capacitor/camera\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngxs/store\";\nimport * as i2 from \"src/app/shared/components/popup/popup.component\";\n\nfunction SuiviChantierDate_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelementStart(1, \"label\", 7);\n    i0.ɵɵtext(2, \"Choisir les t\\u00E2ches pour ce jour\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"div\", 17);\n    i0.ɵɵelementStart(4, \"img\", 18);\n    i0.ɵɵlistener(\"click\", function SuiviChantierDate_div_2_Template_img_click_4_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.swipeMenu = true;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SuiviChantierDate_div_4_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"comment-suivi\", 25);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const supervision_r9 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"supervision\", supervision_r9);\n  }\n}\n\nfunction SuiviChantierDate_div_4_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵelementStart(1, \"input\", 26);\n    i0.ɵɵlistener(\"focusout\", function SuiviChantierDate_div_4_div_8_Template_input_focusout_1_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const task_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.mainComment(task_r6);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"img\", 10);\n    i0.ɵɵlistener(\"click\", function SuiviChantierDate_div_4_div_8_Template_img_click_2_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return ctx_r13.swipeMenuImage = true;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"input_\", task_r6.id, \"\");\n  }\n}\n\nfunction SuiviChantierDate_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵelementStart(1, \"div\", 20);\n    i0.ɵɵelementStart(2, \"span\", 21);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 22);\n    i0.ɵɵelementStart(5, \"img\", 23);\n    i0.ɵɵlistener(\"click\", function SuiviChantierDate_div_4_Template_img_click_5_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const task_r6 = restoredCtx.$implicit;\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.validate(task_r6);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"img\", 23);\n    i0.ɵɵlistener(\"click\", function SuiviChantierDate_div_4_Template_img_click_6_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r16);\n      const task_r6 = restoredCtx.$implicit;\n      const ctx_r17 = i0.ɵɵnextContext();\n      return ctx_r17.refuse(task_r6);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, SuiviChantierDate_div_4_div_7_Template, 2, 1, \"div\", 5);\n    i0.ɵɵtemplate(8, SuiviChantierDate_div_4_div_8_Template, 3, 1, \"div\", 24);\n    i0.ɵɵelement(9, \"div\", 11);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r6 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", task_r6.content, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"control_validate_\", task_r6.id, \"\");\n    i0.ɵɵproperty(\"src\", task_r6.validationImage, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"control_refuse_\", task_r6.id, \"\");\n    i0.ɵɵproperty(\"src\", task_r6.invalidationImage, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", task_r6.supervisionsObject);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", task_r6.refused);\n  }\n}\n\nfunction SuiviChantierDate_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"comment-suivi\", 25);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const supervision_r18 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"supervision\", supervision_r18);\n  }\n}\n\nexport let SuiviChantierDate = /*#__PURE__*/(() => {\n  class SuiviChantierDate extends Destroy$ {\n    constructor(cd, store, popup) {\n      super();\n      this.cd = cd;\n      this.store = store;\n      this.popup = popup;\n      this.swipeMenu = false;\n      this.swipeMenuImage = false;\n      this.view = \"PME\";\n      this.currentTaskId = null;\n\n      this._reloadMission = date => {\n        return [this.date, this.mission];\n      };\n\n      this._date = {\n        id: 0,\n        value: 0,\n        tasks: [],\n        selectedTasks: [],\n        taskWithoutDouble: [],\n        view: this.view,\n        supervisions: []\n      };\n      this._mission = null;\n    }\n\n    get date() {\n      return this._date;\n    }\n\n    set date(date) {\n      this._date = date;\n    }\n\n    get mission() {\n      return this._mission;\n    }\n\n    set mission(mission) {\n      this.view = this.store.selectSnapshot(DataState.view);\n      this._mission = mission;\n    }\n\n    get reloadMission() {\n      return this._reloadMission;\n    }\n\n    set reloadMission(callBack) {\n      this._reloadMission = callBack;\n    }\n\n    takePhoto() {\n      return _asyncToGenerator(function* () {\n        const photo = yield Camera.getPhoto({\n          allowEditing: false,\n          resultType: CameraResultType.Base64,\n          source: CameraSource.Camera\n        }); // this.store.dispatch(new ChangeProfilePicture(photo, 'image'));\n        // scr = photo.format, imageBase64 = photo.base64String, \n      })();\n    }\n\n    selectPhoto() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        const photo = yield Camera.getPhoto({\n          allowEditing: false,\n          resultType: CameraResultType.Base64,\n          source: CameraSource.Photos\n        });\n\n        _this.store.dispatch(new UploadImageSupervision(photo, _this.mission.id, _this.currentTaskId));\n      })();\n    }\n\n    addDateToPost() {\n      this.popup.openDateDialog(this.mission, this.date, this);\n      this.swipeMenu = false;\n    }\n\n    updatePage(content, missionId) {\n      if (content) {\n        this.store.dispatch(new CreateDetailedPost(missionId, content, this.date.value)).pipe(take(1)).subscribe(() => {\n          this.updatePageOnlyDate();\n        });\n      } else {\n        this.updatePageOnlyDate();\n        document.getElementById(\"accordion\");\n      }\n    }\n\n    updatePageOnlyDate() {\n      let [date, mission] = this._reloadMission(this.date);\n\n      this.date = date;\n      this.mission = mission;\n    }\n\n    validate(task) {\n      if (this.view == 'ST' && !task.refused) {\n        task.validated = !task.validated;\n        this.store.dispatch(new ModifyDetailedPost(task)).pipe(take(1)).subscribe(() => {\n          let control = document.getElementById(\"control_validate_\" + task.id);\n          control.src = SuiviPME.computeTaskImage(task, \"validated\");\n        });\n      }\n    }\n\n    refuse(task) {\n      if (this.view == 'ST' && !task.validated) {\n        task.refused = !task.refused;\n        this.store.dispatch(new ModifyDetailedPost(task)).pipe(take(1)).subscribe(() => {\n          this.mission = this.store.selectSnapshot(DataQueries.getById('Mission', this.mission.id));\n          let control = document.getElementById(\"control_refuse_\" + task.id);\n          control.src = SuiviPME.computeTaskImage(task, \"refused\");\n        });\n      }\n    }\n\n    mainComment(task) {\n      let idInput = task ? \"input_\" + task.id : \"input_general\";\n      let input = document.getElementById(idInput);\n      this.currentTaskId = task ? task.id : null;\n\n      if (input) {\n        let detailPostId = task ? task.id : null;\n        this.store.dispatch(new CreateSupervision(this.mission.id, detailPostId, null, input.value, this.date.value)).pipe(take(1)).subscribe(() => {\n          this.updatePageOnlyDate();\n        });\n      }\n    }\n\n  }\n\n  SuiviChantierDate.ɵfac = function SuiviChantierDate_Factory(t) {\n    return new (t || SuiviChantierDate)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.PopupService));\n  };\n\n  SuiviChantierDate.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SuiviChantierDate,\n    selectors: [[\"suivi-chantier_date\"]],\n    inputs: {\n      date: \"date\",\n      mission: \"mission\",\n      reloadMission: \"reloadMission\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 23,\n    vars: 7,\n    consts: [[3, \"title\"], [1, \"form-input\", 3, \"id\"], [\"class\", \"clear-margin full-width flex center-cross space-arround\", 4, \"ngIf\"], [2, \"height\", \"20px\"], [\"class\", \"taskByDate\", \"style\", \"width:97%\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngFor\", \"ngForOf\"], [1, \"form-input\"], [2, \"color\", \"#0C5E8D\", \"padding-left\", \"3%\"], [1, \"divComment\"], [\"id\", \"input_general\", \"type\", \"text\", \"placeholder\", \"Ajouter un commentaire\", 1, \"inputComment\", 3, \"focusout\"], [\"src\", \"assets/camera.png\", 3, \"click\"], [2, \"height\", \"30px\"], [1, \"dashed\", 2, \"margin-left\", \"0 !important\"], [3, \"open\", \"openChange\"], [3, \"click\"], [\"modifyPicture\", \"\"], [1, \"clear-margin\", \"full-width\", \"flex\", \"center-cross\", \"space-arround\"], [2, \"width\", \"45%\"], [\"src\", \"assets/Option.svg\", 3, \"click\"], [1, \"taskByDate\", 2, \"width\", \"97%\"], [1, \"details\", \"flex\", \"center-cross\", \"space-between\"], [1, \"detail-name\"], [1, \"controls\"], [3, \"id\", \"src\", \"click\"], [\"class\", \"divComment\", 4, \"ngIf\"], [3, \"supervision\"], [\"type\", \"text\", \"placeholder\", \"Ajouter un commentaire\", 1, \"inputComment\", 3, \"id\", \"focusout\"]],\n    template: function SuiviChantierDate_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"accordion\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵtemplate(2, SuiviChantierDate_div_2_Template, 5, 0, \"div\", 2);\n        i0.ɵɵelement(3, \"div\", 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, SuiviChantierDate_div_4_Template, 10, 7, \"div\", 4);\n        i0.ɵɵtemplate(5, SuiviChantierDate_div_5_Template, 2, 1, \"div\", 5);\n        i0.ɵɵelementStart(6, \"div\", 6);\n        i0.ɵɵelementStart(7, \"label\", 7);\n        i0.ɵɵtext(8, \"Communiquer avec votre partenaire de chantier\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"div\", 8);\n        i0.ɵɵelementStart(10, \"input\", 9);\n        i0.ɵɵlistener(\"focusout\", function SuiviChantierDate_Template_input_focusout_10_listener() {\n          return ctx.mainComment(null);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"img\", 10);\n        i0.ɵɵlistener(\"click\", function SuiviChantierDate_Template_img_click_11_listener() {\n          return ctx.swipeMenuImage == true;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(12, \"div\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(13, \"hr\", 12);\n        i0.ɵɵelementStart(14, \"swipeup\", 13);\n        i0.ɵɵlistener(\"openChange\", function SuiviChantierDate_Template_swipeup_openChange_14_listener($event) {\n          return ctx.swipeMenu = $event;\n        });\n        i0.ɵɵelementStart(15, \"li\", 14);\n        i0.ɵɵlistener(\"click\", function SuiviChantierDate_Template_li_click_15_listener() {\n          return ctx.addDateToPost();\n        });\n        i0.ɵɵtext(16, \" Modifier les t\\u00E2ches\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"swipeup\", 13, 15);\n        i0.ɵɵlistener(\"openChange\", function SuiviChantierDate_Template_swipeup_openChange_17_listener($event) {\n          return ctx.swipeMenuImage = $event;\n        });\n        i0.ɵɵelementStart(19, \"li\", 14);\n        i0.ɵɵlistener(\"click\", function SuiviChantierDate_Template_li_click_19_listener() {\n          return ctx.takePhoto();\n        });\n        i0.ɵɵtext(20, \"Acc\\u00E9dez \\u00E0 l'appareil photo\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"li\", 14);\n        i0.ɵɵlistener(\"click\", function SuiviChantierDate_Template_li_click_21_listener() {\n          return ctx.selectPhoto();\n        });\n        i0.ɵɵtext(22, \"T\\u00E9l\\u00E9charger une image\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"title\", \"Le \" + ctx.date.value);\n        i0.ɵɵadvance(1);\n        i0.ɵɵpropertyInterpolate1(\"id\", \"taskMain_\", ctx.date.id, \"\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.date.view == \"PME\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.date.selectedTasks);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.date.supervisions);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"open\", ctx.swipeMenu);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"open\", ctx.swipeMenuImage);\n      }\n    },\n    styles: [\".controls[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:first-child{margin-right:15px}.divComment[_ngcontent-%COMP%]{display:flex;flex-direction:row;border:1px solid #0D6191;border-radius:20px;height:40px;margin:15px;width:96%;padding:10px}.inputComment[_ngcontent-%COMP%]{width:90%}.detail-name[_ngcontent-%COMP%]{padding-left:3%;width:80%}.newDate[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;width:50%;margin-left:25%;margin-top:30px}.liDate[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-around;width:90%}\"],\n    changeDetection: 0\n  });\n  return SuiviChantierDate;\n})();","map":null,"metadata":{},"sourceType":"module"}