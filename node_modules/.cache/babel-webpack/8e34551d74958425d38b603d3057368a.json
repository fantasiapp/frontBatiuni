{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Select } from \"@ngxs/store\";\nimport { Destroy$ } from \"src/app/shared/common/classes\";\nimport { CalendarUI } from \"src/app/shared/components/calendar/calendar.ui\";\nimport { nameToAvailability } from \"src/models/new/data.mapper\";\nimport { DataQueries } from \"src/models/new/data.state\";\nimport { ModifyAvailability } from \"src/models/new/user/user.actions\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngxs/store\";\nimport * as i2 from \"src/app/shared/components/tooltip/tooltip.component\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../../shared/forms/OnlineFilter.form\";\nimport * as i5 from \"../../../shared/components/calendar/calendar.ui\";\nconst _c0 = [\"calendar\"];\n\nfunction DispoPage_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 1);\n    i0.ɵɵelementStart(2, \"section\", 2);\n    i0.ɵɵelementStart(3, \"div\", 3);\n    i0.ɵɵelement(4, \"img\", 4);\n    i0.ɵɵtext(5, \" Filtrer par \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"online-filter-form\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"section\", 5);\n    i0.ɵɵelementStart(8, \"calendar\", 6);\n    i0.ɵɵlistener(\"dayClick\", function DispoPage_ng_container_0_Template_calendar_dayClick_8_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.onDayClicked($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 7);\n    i0.ɵɵelementStart(10, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function DispoPage_ng_container_0_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.submit();\n    });\n    i0.ɵɵtext(11, \"Enregistrer\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"section\", 9);\n    i0.ɵɵelementStart(13, \"div\", 10);\n    i0.ɵɵtext(14, \"\\u24D8\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"li\", 11);\n    i0.ɵɵtext(16, \" Disponible \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"li\", 12);\n    i0.ɵɵtext(18, \" Disponible sous-conditions \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"li\", 13);\n    i0.ɵɵtext(20, \" Pas disponible \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"li\", 14);\n    i0.ɵɵtext(22, \" Non-renseigner \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"value\", ctx_r0.availabilities);\n  }\n}\n\nexport class DispoPage extends Destroy$ {\n  constructor(store, tooltipService) {\n    super();\n    this.store = store;\n    this.tooltipService = tooltipService;\n    this.availabilities = [];\n    this.items = [{\n      name: 'Disponible',\n      class: 'disponible',\n      click: () => {\n        this.setCalendarDayState('available');\n      }\n    }, {\n      name: 'Disponible sous-conditions',\n      class: 'sous-conditions',\n      click: () => {\n        this.setCalendarDayState('availablelimits');\n      }\n    }, {\n      name: 'Pas disponible',\n      class: 'pas-disponible',\n      click: () => {\n        this.setCalendarDayState('unavailable');\n      }\n    }, {\n      name: 'Non renseigné',\n      class: 'non-renseigne',\n      click: () => {\n        this.setCalendarDayState('nothing');\n      }\n    }];\n    this.dimension = {\n      left: '0',\n      top: '0',\n      width: '300px',\n      height: '150px'\n    };\n  }\n\n  ngOnInit() {\n    this.profile$.subscribe(profile => {\n      this.availabilities = this.store.selectSnapshot(DataQueries.getMany('Disponibility', profile.company.availabilities)).map(availability => ({\n        date: availability.date,\n        availability: nameToAvailability(availability.nature)\n      }));\n    });\n  }\n\n  getDimensionFromEvent(e) {\n    const ev = e,\n          pageX = Math.min(ev.pageX, window.innerWidth - 300),\n          pageY = Math.min(ev.pageY, window.innerHeight - 200);\n    return Object.assign(Object.assign({}, this.dimension), {\n      left: pageX + 'px',\n      top: pageY + 'px'\n    });\n  }\n\n  submit() {\n    this.store.dispatch(ModifyAvailability.fromCalendar(this.calendar));\n  }\n\n  onDayClicked([ev, _]) {\n    this.tooltipService.reshape(this.dimension = this.getDimensionFromEvent(ev));\n    this.tooltipService.show({\n      type: 'menu',\n      items: this.items,\n      hideOnClick: true,\n      class: 'availability-picker'\n    });\n  }\n\n  setCalendarDayState(state) {\n    this.calendar.setCurrentDayState(state);\n  }\n\n}\n\nDispoPage.ɵfac = function DispoPage_Factory(t) {\n  return new (t || DispoPage)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.UITooltipService));\n};\n\nDispoPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DispoPage,\n  selectors: [[\"dispo-page\"]],\n  viewQuery: function DispoPage_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5, CalendarUI);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.calendar = _t.first);\n    }\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 2,\n  vars: 3,\n  consts: [[4, \"ngIf\"], [1, \"web-page\"], [1, \"filters\"], [1, \"header\"], [\"src\", \"assets/Filter.svg\"], [1, \"main\", \"web-content\", \"font-Poppins\"], [3, \"value\", \"dayClick\"], [1, \"flex\", \"full-width\", 2, \"justify-content\", \"end\"], [1, \"button\", \"active\", 3, \"click\"], [1, \"info\", \"space-children-margin\", \"back\"], [1, \"flex\", \"center\", \"full-width\", \"info-bar\"], [1, \"disponible\"], [1, \"sous-conditions\"], [1, \"pas-disponible\"], [1, \"non-renseigne\"]],\n  template: function DispoPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, DispoPage_ng_container_0_Template, 23, 1, \"ng-container\", 0);\n      i0.ɵɵpipe(1, \"async\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.profile$));\n    }\n  },\n  directives: [i3.NgIf, i4.OnlineFilterForm, i5.CalendarUI],\n  pipes: [i3.AsyncPipe],\n  styles: [\".page-content-with-tabs[_ngcontent-%COMP%]{width:100%;overflow-y:auto;overflow-x:hidden;touch-action:pan-y!important}.page-content-with-tabs[_ngcontent-%COMP%]{margin-top:150px;margin-top:calc(constant(safe-area-inset-top) + 150px);margin-top:calc(env(safe-area-inset-top) + 150px);margin-bottom:0;margin-bottom:calc(constant(safe-area-inset-bottom) + 0);margin-bottom:calc(env(safe-area-inset-bottom) + 0);height:calc(100vh - 220px - env(safe-area-inset-bottom))}.invert[_ngcontent-%COMP%]{filter:invert(1)}[_ngcontent-%COMP%]:root{--notification-size: $notification-size}[_nghost-%COMP%]{display:block;list-style-type:none}@media (min-width: 769px) and (max-width: 1500px){.filters[_ngcontent-%COMP%]{display:none}.info[_ngcontent-%COMP%]{display:none}.filterOnly[_ngcontent-%COMP%]{display:block!important}}.web-content[_ngcontent-%COMP%]   searchbar[_ngcontent-%COMP%]{display:block;width:80%;font-size:1em;margin:0 auto}.report-search[_ngcontent-%COMP%]{padding:30px 0}tabs[_ngcontent-%COMP%]{position:fixed;width:100%;top:170px}.filters[_ngcontent-%COMP%]{overflow:hidden!important}calendar[_ngcontent-%COMP%]  .wrapper-calendar{padding:20px}calendar[_ngcontent-%COMP%]  .wrapper-calendar li{justify-self:center!important}.info-bar[_ngcontent-%COMP%]{font-size:2rem;color:#0d6191}  .non-renseigne:before,   .pas-disponible:before,   .sous-conditions:before,   .disponible:before{content:\\\"\\\";display:inline-block;vertical-align:middle;margin-right:10px}  .disponible:before{border-radius:50%;background-color:#b9edaf;width:1.2em;height:1.2em}  .sous-conditions:before{border-radius:50%;background-color:#ffc425;width:1.2em;height:1.2em}  .pas-disponible:before{border-radius:50%;background-color:#e80000;width:1.2em;height:1.2em}  .non-renseigne:before{border-radius:50%;background-color:#fafafa;width:1.1em;height:1.1em;border:1px solid black}  .availability-picker{box-shadow:#00000029 0 1px 4px;border-radius:12px;padding:20px}  .availability-picker li:hover{background-color:#fcfcfc;color:#0d6191!important;transform:scale(1.01)!important}  .availability-picker>*:not(:last-child){margin-bottom:8px}\"],\n  changeDetection: 0\n});\n\n__decorate([Select(DataQueries.currentProfile)], DispoPage.prototype, \"profile$\", void 0);\n\n;","map":null,"metadata":{},"sourceType":"module"}