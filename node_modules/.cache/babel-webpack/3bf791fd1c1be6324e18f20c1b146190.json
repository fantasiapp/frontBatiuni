{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Select } from \"@ngxs/store\";\nimport { combineLatest } from \"rxjs\";\nimport { takeUntil } from \"rxjs/operators\";\nimport { Destroy$ } from \"src/app/shared/common/classes\";\nimport { assignCopy } from \"src/app/shared/common/functions\";\nimport { PostMenu } from \"src/models/new/data.interfaces\";\nimport { DataQueries, QueryAll } from \"src/models/new/data.state\";\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngxs/store\";\nimport * as i2 from \"src/app/shared/components/info/info.component\";\n\nfunction MissionsComponent_ng_container_7_offer_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"offer\", 12);\n    i0.ɵɵlistener(\"click\", function MissionsComponent_ng_container_7_offer_1_Template_offer_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const mission_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return ctx_r4.openMission(mission_r3);\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const mission_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"post\", mission_r3);\n  }\n}\n\nfunction MissionsComponent_ng_container_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, MissionsComponent_ng_container_7_offer_1_Template, 1, 1, \"offer\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.myMissions);\n  }\n}\n\nfunction MissionsComponent_horizontal_calendar_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"horizontal-calendar\", 13);\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"detailedDays\", ctx_r1.detailedDays);\n  }\n}\n\nexport class MissionsComponent extends Destroy$ {\n  constructor(store, info) {\n    super();\n    this.store = store;\n    this.info = info;\n    this.activeView = 0;\n    this.openFilterMenu = false;\n    this.myMissions = [];\n    this.missionMenu = new PostMenu();\n    this.detailedDays = [];\n  }\n\n  ngOnInit() {\n    this.info.alignWith('header_search');\n    combineLatest([this.profile$, this.missions$]).pipe(takeUntil(this.destroy$)).subscribe(([profile, missions]) => {\n      //filter own missions\n      //for now accept all misisons\n      this.myMissions = missions.filter(mission => mission.subContractor == profile.company.id); //compute work days\n\n      this.detailedDays.length = 0;\n\n      for (const mission of this.myMissions) {\n        const start = moment(mission.startDate),\n              end = moment(mission.endDate),\n              contractor = this.store.selectSnapshot(DataQueries.getById('Company', mission.company));\n        const diffDays = end.diff(start, 'days', true);\n        let day = start.clone();\n\n        for (let i = 0; i < diffDays; i++) {\n          this.detailedDays.push({\n            date: day.locale('fr').format('YYYY-MM-DD'),\n            start: mission.hourlyStart,\n            end: mission.hourlyEnd,\n            text: 'Chantier de ' + contractor.name\n          });\n          day = day.add(1, 'day');\n        }\n      }\n    });\n  }\n\n  openMission(mission) {\n    this.missionMenu = assignCopy(this.missionMenu, {\n      post: mission,\n      open: !!mission,\n      swipeup: false\n    });\n  }\n\n  ngOnDestroy() {\n    this.info.alignWith('last');\n    super.ngOnDestroy();\n  }\n\n}\n\nMissionsComponent.ɵfac = function MissionsComponent_Factory(t) {\n  return new (t || MissionsComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.InfoService));\n};\n\nMissionsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MissionsComponent,\n  selectors: [[\"missions\"]],\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 13,\n  vars: 7,\n  consts: [[\"name\", \"Mes missions\", 3, \"activeView\", \"activeViewChange\", \"filterClicked\"], [\"tab_0\", \"\"], [\"tab_1\", \"\"], [1, \"hosted-page\", \"space-children-margin\", \"page-content-with-tabs\"], [3, \"ngSwitch\"], [4, \"ngSwitchCase\"], [\"class\", \"space-children-margin\", 3, \"detailedDays\", 4, \"ngSwitchCase\"], [\"title\", \"Mission\", 3, \"open\", \"openChange\"], [\"content\", \"\", 3, \"mission\"], [\"type\", \"view\", 3, \"open\", \"openChange\"], [\"view\", \"\"], [\"src\", \"assets/valid\\u00E9e.svg\", 3, \"post\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"src\", \"assets/valid\\u00E9e.svg\", 3, \"post\", \"click\"], [1, \"space-children-margin\", 3, \"detailedDays\"]],\n  template: function MissionsComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"page-header\", 0);\n      i0.ɵɵlistener(\"activeViewChange\", function MissionsComponent_Template_page_header_activeViewChange_0_listener($event) {\n        return ctx.activeView = $event;\n      })(\"filterClicked\", function MissionsComponent_Template_page_header_filterClicked_0_listener() {\n        return ctx.openFilterMenu = true;\n      });\n      i0.ɵɵelementStart(1, \"span\", 1);\n      i0.ɵɵtext(2, \"Vue liste\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"span\", 2);\n      i0.ɵɵtext(4, \"Calendrier\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"div\", 3);\n      i0.ɵɵelementContainerStart(6, 4);\n      i0.ɵɵtemplate(7, MissionsComponent_ng_container_7_Template, 2, 1, \"ng-container\", 5);\n      i0.ɵɵtemplate(8, MissionsComponent_horizontal_calendar_8_Template, 1, 1, \"horizontal-calendar\", 6);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"slidemenu\", 7);\n      i0.ɵɵlistener(\"openChange\", function MissionsComponent_Template_slidemenu_openChange_9_listener($event) {\n        return ctx.missionMenu.open = $event;\n      });\n      i0.ɵɵelement(10, \"suivi-chantier\", 8);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"swipeup\", 9);\n      i0.ɵɵlistener(\"openChange\", function MissionsComponent_Template_swipeup_openChange_11_listener($event) {\n        return ctx.openFilterMenu = $event;\n      });\n      i0.ɵɵelement(12, \"mission-filter-form\", 10);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"activeView\", ctx.activeView);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngSwitch\", ctx.activeView);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngSwitchCase\", 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngSwitchCase\", 1);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"open\", ctx.missionMenu.open);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"mission\", ctx.missionMenu.post);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"open\", ctx.openFilterMenu);\n    }\n  },\n  styles: [\"[_ngcontent-%COMP%]:root{--notification-size: $notification-size}.page-content-with-tabs[_ngcontent-%COMP%], [_nghost-%COMP%]{width:100%;overflow-y:auto;overflow-x:hidden;touch-action:pan-y!important}[_nghost-%COMP%]{display:block;height:calc(100vh - 70px - env(safe-area-inset-bottom))}.page-content-with-tabs[_ngcontent-%COMP%]{margin-top:150px;margin-top:calc(constant(safe-area-inset-top) + 150px);margin-top:calc(env(safe-area-inset-top) + 150px);margin-bottom:0;margin-bottom:calc(constant(safe-area-inset-bottom) + 0);margin-bottom:calc(env(safe-area-inset-bottom) + 0);height:calc(100vh - 220px - env(safe-area-inset-bottom))}.invert[_ngcontent-%COMP%]{filter:invert(1)}switch[_ngcontent-%COMP%]  .slider{background:#ccc}\"],\n  changeDetection: 0\n});\n\n__decorate([Select(DataQueries.currentProfile)], MissionsComponent.prototype, \"profile$\", void 0);\n\n__decorate([QueryAll('Mission')], MissionsComponent.prototype, \"missions$\", void 0);\n\n;","map":null,"metadata":{},"sourceType":"module"}