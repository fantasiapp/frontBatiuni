{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Select } from \"@ngxs/store\";\nimport { DataQueries } from \"src/models/new/data.state\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngxs/store\";\nimport * as i2 from \"../../ui/annonce-resume/annonce-resume.ui\";\nimport * as i3 from \"../../../shared/components/FileIcon/file.icon\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../../shared/components/swipeup/swipeup.component\";\nimport * as i6 from \"../../../shared/components/accordion/accordion.ui\";\nimport * as i7 from \"../../../shared/components/comment/comment.ui\";\n\nfunction SuiviPME_ng_container_13_li_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\", 18);\n    i0.ɵɵelementStart(1, \"div\", 19);\n    i0.ɵɵelementStart(2, \"span\", 20);\n    i0.ɵɵtext(3, \"Lorem ipsum dolor sit amet\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 21);\n    i0.ɵɵelementStart(5, \"img\", 22);\n    i0.ɵɵlistener(\"click\", function SuiviPME_ng_container_13_li_5_Template_img_click_5_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const detail_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.validate(detail_r5.key);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"img\", 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"comment\", 24);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"edit\", false)(\"profile\", ctx_r4.currentProfile$);\n  }\n}\n\nfunction SuiviPME_ng_container_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"accordion\", 13);\n    i0.ɵɵelementStart(2, \"h4\", 14);\n    i0.ɵɵtext(3, \"Liste des t\\u00E2ches pour ce jour\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ul\", 15);\n    i0.ɵɵtemplate(5, SuiviPME_ng_container_13_li_5_Template, 8, 2, \"li\", 16);\n    i0.ɵɵpipe(6, \"keyvalue\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"hr\", 17);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const supervision_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"title\", \"Le \" + supervision_r3.key);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(6, 2, supervision_r3.value));\n  }\n}\n\nfunction SuiviPME_ng_template_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"comment\", 25);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵproperty(\"edit\", true);\n  }\n}\n\nexport class SuiviPME {\n  constructor(store) {\n    this.store = store;\n    this.company = null;\n    this.track = {}; //track[data][detail]\n\n    this._mission = null;\n    this.swipemenu = false;\n  }\n\n  get mission() {\n    return this._mission;\n  }\n\n  set mission(mission) {\n    this._mission = mission;\n    this.company = mission ? this.store.selectSnapshot(DataQueries.getById('Company', mission.company)) : null; //load all supervisions, group by days\n\n    if (mission) {\n      const details = this.store.selectSnapshot(DataQueries.getMany('DetailedPost', mission.details));\n      details.forEach(detail => {\n        const supervisions = this.store.selectSnapshot(DataQueries.getMany('Supervision', detail.supervisions));\n\n        for (const supervision of supervisions) {\n          const existing = this.track[supervision.date];\n\n          if (existing) {\n            if (existing.has(detail)) existing.get(detail).push(supervision);else existing.set(detail, [supervision]);\n          } else {\n            this.track[supervision.date] = new Map();\n            this.track[supervision.date].set(detail, [supervision]);\n          }\n        }\n      });\n    }\n  }\n\n  validate(key) {\n    console.log(key);\n  }\n\n}\n\nSuiviPME.ɵfac = function SuiviPME_Factory(t) {\n  return new (t || SuiviPME)(i0.ɵɵdirectiveInject(i1.Store));\n};\n\nSuiviPME.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: SuiviPME,\n  selectors: [[\"suivi-pme\"]],\n  inputs: {\n    mission: \"mission\"\n  },\n  decls: 26,\n  vars: 7,\n  consts: [[1, \"container\", \"hosted-page\", \"space-children-margin\"], [3, \"collapsed\", \"application\", \"post\"], [1, \"contrat\"], [1, \"title\", \"font-Poppins\", 2, \"margin-bottom\", \"20px\"], [1, \"flex\", \"center-cross\", \"space-around\"], [\"name\", \"Contrat\", \"color\", \"red\"], [1, \"contrat-title\", \"font-Poppins\"], [1, \"suivi-notification\", \"flex\", \"center-cross\"], [1, \"font-Poppins\"], [1, \"full-width\", \"flex\", \"column\"], [4, \"ngFor\", \"ngForOf\"], [3, \"open\", \"openChange\"], [\"comment\", \"\"], [3, \"title\"], [1, \"subtitle\"], [1, \"list\", \"space-children-margin\"], [\"class\", \"item\", 4, \"ngFor\", \"ngForOf\"], [1, \"dashed\"], [1, \"item\"], [1, \"details\", \"flex\", \"center-cross\", \"space-between\"], [1, \"detail-name\"], [1, \"controls\"], [\"src\", \"assets/suivi-valider.svg\", 3, \"click\"], [\"src\", \"assets/suivi-refuser.svg\"], [3, \"edit\", \"profile\"], [3, \"edit\"]],\n  template: function SuiviPME_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelement(1, \"annonce-resume\", 1);\n      i0.ɵɵelementStart(2, \"div\", 2);\n      i0.ɵɵelementStart(3, \"h6\", 3);\n      i0.ɵɵtext(4, \" Le contrat \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"div\", 4);\n      i0.ɵɵelement(6, \"file-svg\", 5);\n      i0.ɵɵelementStart(7, \"h6\", 6);\n      i0.ɵɵtext(8, \" Signer le contrat \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"div\", 7);\n      i0.ɵɵelementStart(10, \"h6\", 8);\n      i0.ɵɵtext(11, \" Suivi du chantier \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"div\", 9);\n      i0.ɵɵtemplate(13, SuiviPME_ng_container_13_Template, 8, 4, \"ng-container\", 10);\n      i0.ɵɵpipe(14, \"keyvalue\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"swipeup\", 11);\n      i0.ɵɵlistener(\"openChange\", function SuiviPME_Template_swipeup_openChange_15_listener($event) {\n        return ctx.swipemenu = $event;\n      });\n      i0.ɵɵelementStart(16, \"li\");\n      i0.ɵɵtext(17, \"Modifier les horaires de pr\\u00E9sence\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"li\");\n      i0.ɵɵtext(19, \"Appeler le 06 21 94 03 86\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(20, \"li\");\n      i0.ɵɵtext(21, \"Cl\\u00F4turer la mission\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"li\");\n      i0.ɵɵtext(23, \"Dupliquer l'annonce\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(24, SuiviPME_ng_template_24_Template, 1, 1, \"ng-template\", null, 12, i0.ɵɵtemplateRefExtractor);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"collapsed\", true)(\"application\", false)(\"post\", ctx.mission);\n      i0.ɵɵadvance(12);\n      i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(14, 5, ctx.track));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"open\", ctx.swipemenu);\n    }\n  },\n  directives: [i2.UIAnnonceResume, i3.FileIcon, i4.NgForOf, i5.UISwipeupComponent, i6.UIAccordion, i7.UIComment],\n  pipes: [i4.KeyValuePipe],\n  styles: [\"[_ngcontent-%COMP%]:root{--notification-size: $notification-size}.page-content-with-tabs[_ngcontent-%COMP%]{width:100%;overflow-y:auto;overflow-x:hidden;touch-action:pan-y!important}.page-content-with-tabs[_ngcontent-%COMP%]{margin-top:150px;margin-top:calc(constant(safe-area-inset-top) + 150px);margin-top:calc(env(safe-area-inset-top) + 150px);margin-bottom:0;margin-bottom:calc(constant(safe-area-inset-bottom) + 0);margin-bottom:calc(env(safe-area-inset-bottom) + 0);height:calc(100vh - 220px - env(safe-area-inset-bottom))}.invert[_ngcontent-%COMP%]{filter:invert(1)}[_nghost-%COMP%]{display:block;width:100%}.annonce[_ngcontent-%COMP%]{background:#FFFFFF!important;color:#000}.dashed[_ngcontent-%COMP%]{margin-left:-30px!important;display:block;width:100vw;border-top:1px dashed black}.contrat-title[_ngcontent-%COMP%]{color:#0d6191;font-size:1rem}.suivi-notification[_ngcontent-%COMP%]{width:100vw;margin-left:-30px;padding-left:30px;color:#fff;height:80px;background-color:#0d6191}.suivi-notification[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:200;font-size:1em}details[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]::-webkit-details-marker{display:none!important}.subtitle[_ngcontent-%COMP%]{color:#0d6191}.red[_ngcontent-%COMP%]{filter:invert(24%) sepia(89%) saturate(7468%) hue-rotate(360deg) brightness(104%) contrast(123%)}.green[_ngcontent-%COMP%]{filter:invert(74%) sepia(69%) saturate(5734%) hue-rotate(85deg) brightness(116%) contrast(131%)}.controls[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:first-child{margin-right:15px}\"],\n  changeDetection: 0\n});\n\n__decorate([Select(DataQueries.currentProfile)], SuiviPME.prototype, \"currentProfile$\", void 0);","map":null,"metadata":{},"sourceType":"module"}