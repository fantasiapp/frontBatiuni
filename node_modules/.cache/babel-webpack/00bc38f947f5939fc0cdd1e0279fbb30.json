{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { bufferCount, debounceTime, map, take, takeUntil } from \"rxjs/operators\";\nimport { Register } from \"src/models/auth/auth.actions\";\nimport { ComplexPassword, MatchField, RequiredType, setErrors, TransferError } from \"src/validators/verify\";\nimport { SlidesDirective } from \"../directives/slides.directive\";\nimport { Email } from \"src/validators/persist\";\nimport { merge, Subject } from \"rxjs\";\nimport { UISuggestionBox } from \"../components/suggestionbox/suggestionbox.component\";\nimport { Destroy$ } from \"../common/classes\";\nimport { SnapshotAll } from \"src/models/new/data.state\";\nimport { GetCompanies } from \"src/models/new/search/search.actions\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngxs/store\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../directives/slides.directive\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"../common/formerrors\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../components/options/options\";\nimport * as i8 from \"../components/suggestionbox/suggestionbox.component\";\n\nfunction RegisterForm_ng_template_1_button_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function RegisterForm_ng_template_1_button_26_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.slider.left();\n    });\n    i0.ɵɵtext(1, \"Etape suivante\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction RegisterForm_ng_template_1_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelement(1, \"div\", 17);\n    i0.ɵɵelementStart(2, \"div\", 18);\n    i0.ɵɵlistener(\"click\", function RegisterForm_ng_template_1_div_27_Template_div_click_2_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.slider.left();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction RegisterForm_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"form\", 3);\n    i0.ɵɵelementStart(1, \"h3\", 4);\n    i0.ɵɵtext(2, \"Cr\\u00E9er un compte !\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h4\", 5);\n    i0.ɵɵtext(4, \"Informations contact\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 6);\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Nom du contact\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"input\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 6);\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Pr\\u00E9nom du contact\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"input\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 6);\n    i0.ɵɵelementStart(14, \"label\");\n    i0.ɵɵtext(15, \"Adresse e-mail contact\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"input\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"div\", 6);\n    i0.ɵɵelementStart(18, \"label\");\n    i0.ɵɵtext(19, \"V\\u00E9rification addresse e-mail\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(20, \"input\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"div\", 6);\n    i0.ɵɵelementStart(22, \"label\");\n    i0.ɵɵtext(23, \"Mot de passe\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(24, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"div\", 12);\n    i0.ɵɵtemplate(26, RegisterForm_ng_template_1_button_26_Template, 2, 0, \"button\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(27, RegisterForm_ng_template_1_div_27_Template, 3, 0, \"div\", 14);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.registerForm);\n    i0.ɵɵadvance(26);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.showSubmitButton);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.showSteps);\n  }\n}\n\nfunction RegisterForm_ng_template_3_img_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"img\", 32);\n    i0.ɵɵlistener(\"click\", function RegisterForm_ng_template_3_img_16_Template_img_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      i0.ɵɵnextContext();\n\n      const _r10 = i0.ɵɵreference(15);\n\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.cancelCompany() && _r10.focus();\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction RegisterForm_ng_template_3_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵelementStart(1, \"button\", 34);\n    i0.ɵɵtext(2, \"Valider\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", !ctx_r12.registerForm.valid && !ctx_r12.pending);\n  }\n}\n\nfunction RegisterForm_ng_template_3_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 35);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r13 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r13.registerForm.errors == null ? null : ctx_r13.registerForm.errors.server, \" \");\n  }\n}\n\nfunction RegisterForm_ng_template_3_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelementStart(1, \"div\", 18);\n    i0.ɵɵlistener(\"click\", function RegisterForm_ng_template_3_div_29_Template_div_click_1_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return ctx_r17.slider.right();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(2, \"div\", 17);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction RegisterForm_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"form\", 19);\n    i0.ɵɵlistener(\"ngSubmit\", function RegisterForm_ng_template_3_Template_form_ngSubmit_0_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return ctx_r19.onSubmit($event);\n    });\n    i0.ɵɵelementStart(1, \"h3\", 4);\n    i0.ɵɵtext(2, \"Cr\\u00E9er un compte !\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h4\", 5);\n    i0.ɵɵtext(4, \"Informations contact\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 6);\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Je suis\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"options\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 6);\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Nom de l'entreprise\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"input\", 21);\n    i0.ɵɵelementStart(13, \"span\", 22);\n    i0.ɵɵelementStart(14, \"input\", 23, 24);\n    i0.ɵɵlistener(\"input\", function RegisterForm_ng_template_3_Template_input_input_14_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return ctx_r21.onCompanySearch($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, RegisterForm_ng_template_3_img_16_Template, 1, 0, \"img\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"suggestion-box\", 26);\n    i0.ɵɵlistener(\"choice\", function RegisterForm_ng_template_3_Template_suggestion_box_choice_17_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return ctx_r22.onChoice($event);\n    });\n    i0.ɵɵpipe(18, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 6);\n    i0.ɵɵelementStart(20, \"label\");\n    i0.ɵɵtext(21, \"M\\u00E9tier\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(22, \"options\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 28);\n    i0.ɵɵelementStart(24, \"label\");\n    i0.ɵɵtext(25, \"Code parrain ?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(26, \"input\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(27, RegisterForm_ng_template_3_div_27_Template, 3, 1, \"div\", 30);\n    i0.ɵɵtemplate(28, RegisterForm_ng_template_3_div_28_Template, 2, 1, \"div\", 31);\n    i0.ɵɵtemplate(29, RegisterForm_ng_template_3_div_29_Template, 3, 0, \"div\", 14);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r3.registerForm);\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"options\", ctx_r3.roles)(\"searchable\", false);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"novalidate\", true);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.suggestionBox && ctx_r3.suggestionBox.picked);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"query\", i0.ɵɵpipeBind1(18, 11, ctx_r3.searchQuery))(\"action\", ctx_r3.actions.GetCompanies);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"options\", ctx_r3.jobs);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.showSubmitButton);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.registerForm.errors == null ? null : ctx_r3.registerForm.errors.server);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.showSteps);\n  }\n}\n\nconst _c0 = function (a0, a1) {\n  return [a0, a1];\n};\n\nexport class RegisterForm extends Destroy$ {\n  constructor(store, router, cd) {\n    super();\n    this.store = store;\n    this.router = router;\n    this.cd = cd;\n    this.onMobile = window.innerWidth <= 768;\n    this.showSteps = true;\n    this.showSubmitButton = true;\n    this.pending = false;\n    this.registerForm = new FormGroup({\n      lastname: new FormControl('', [Validators.required]),\n      firstname: new FormControl('', [Validators.required]),\n      email: new FormControl('', [Validators.required, Email()]),\n      emailVerification: new FormControl('', [Validators.required, MatchField('email', 'email', true)]),\n      password: new FormControl('', [ComplexPassword()]),\n      proposer: new FormControl(''),\n      role: new FormControl([], [Validators.required]),\n      company: new FormControl('', [Validators.required, RequiredType('object', 'MESSAGE', 'Veuillez choisir une entreprise de la liste.'), TransferError('companyName')]),\n      companyName: new FormControl(''),\n      jobs: new FormControl([], [Validators.required])\n    }, {});\n    this.searchQuery = new Subject();\n    this.searchEvent = new Subject();\n    this.actions = {\n      GetCompanies\n    };\n  } //move this statement to parent\n\n\n  get classes() {\n    return 'hosted-page flex column';\n  }\n\n  onSubmit(f) {\n    this.pending = !this.pending;\n    this.store.dispatch(Register.fromFormGroup(this.registerForm)).pipe(take(1)).subscribe(success => {\n      this.router.navigate(['', 'success']);\n    }, errors => {\n      this.pending = !this.pending;\n\n      if (errors.email) {\n        errors.all = errors.all ? errors.all + '\\n' + errors.email : errors.email;\n      }\n\n      setErrors(this.registerForm, errors);\n      this.cd.markForCheck();\n    });\n  }\n\n  ngOnInit() {\n    const ev = this.searchEvent.pipe(takeUntil(this.destroy$)),\n          eachFour = ev.pipe(bufferCount(4), map(l => l[l.length - 1])),\n          eachSecond = ev.pipe(debounceTime(1000));\n    let lastValue = '';\n    merge(eachFour, eachSecond).subscribe(e => {\n      const value = e.target.value;\n\n      if (value !== lastValue) {\n        lastValue = value;\n        this.searchQuery.next(value);\n      }\n    });\n  }\n\n  onNavigate(dx, done) {\n    if (dx > 0) this.slider.left();else this.slider.right();\n  }\n\n  onCompanySearch(e) {\n    var _a, _b;\n\n    const value = e.target.value;\n    if (!value) (_a = this.suggestionBox) === null || _a === void 0 ? void 0 : _a.hideSuggestions();\n    this.searchEvent.next(e);\n    (_b = this.registerForm.get('company')) === null || _b === void 0 ? void 0 : _b.setValue(value);\n  }\n\n  onChoice(establishment) {\n    var _a, _b;\n\n    (_a = this.registerForm.get('company')) === null || _a === void 0 ? void 0 : _a.setValue(establishment);\n    (_b = this.registerForm.get('companyName')) === null || _b === void 0 ? void 0 : _b.setValue(establishment.name);\n  }\n\n  cancelCompany() {\n    var _a, _b;\n\n    (_a = this.registerForm.get('company')) === null || _a === void 0 ? void 0 : _a.setValue('');\n    (_b = this.registerForm.get('companyName')) === null || _b === void 0 ? void 0 : _b.setValue('');\n    if (this.suggestionBox) this.suggestionBox.cancel();\n    return true;\n  }\n\n}\n\nRegisterForm.ɵfac = function RegisterForm_Factory(t) {\n  return new (t || RegisterForm)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n};\n\nRegisterForm.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: RegisterForm,\n  selectors: [[\"register-form\"]],\n  viewQuery: function RegisterForm_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(UISuggestionBox, 5);\n      i0.ɵɵviewQuery(SlidesDirective, 7);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.suggestionBox = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.slider = _t.first);\n    }\n  },\n  hostVars: 2,\n  hostBindings: function RegisterForm_HostBindings(rf, ctx) {\n    if (rf & 2) {\n      i0.ɵɵclassMap(ctx.classes);\n    }\n  },\n  inputs: {\n    showSteps: \"showSteps\",\n    showSubmitButton: \"showSubmitButton\"\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 5,\n  vars: 5,\n  consts: [[\"type\", \"template\", 1, \"content\", 3, \"slides\", \"animate\"], [\"page1\", \"\"], [\"page2\", \"\"], [1, \"full-width\", \"form-control\", \"curved-border\", 3, \"formGroup\"], [1, \"form-title\"], [1, \"form-subtitle\"], [1, \"form-input\"], [\"type\", \"text\", \"formControlName\", \"lastname\"], [\"type\", \"text\", \"formControlName\", \"firstname\"], [\"type\", \"email\", \"formControlName\", \"email\"], [\"type\", \"email\", \"formControlName\", \"emailVerification\"], [\"type\", \"password\", \"formControlName\", \"password\"], [1, \"form-action\"], [\"class\", \"button discover gradient\", \"style\", \"width: 250px\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"form-step\", 4, \"ngIf\"], [1, \"button\", \"discover\", \"gradient\", 2, \"width\", \"250px\", 3, \"click\"], [1, \"form-step\"], [1, \"active\"], [3, \"click\"], [1, \"full-width\", \"grow\", \"form-control\", \"curved-border\", 3, \"formGroup\", \"ngSubmit\"], [\"formControlName\", \"role\", \"type\", \"radio\", \"ifEmpty\", \"...\", 3, \"options\", \"searchable\"], [\"type\", \"text\", \"formControlName\", \"company\", 1, \"form-element\", 2, \"display\", \"none\"], [1, \"position-relative\"], [\"type\", \"text\", \"autocomplete\", \"off\", \"formControlName\", \"companyName\", 1, \"form-element\", 3, \"novalidate\", \"input\"], [\"search\", \"\"], [\"src\", \"assets/X.svg\", \"class\", \"cancel-company\", 3, \"click\", 4, \"ngIf\"], [3, \"query\", \"action\", \"choice\"], [\"formControlName\", \"jobs\", 3, \"options\"], [1, \"form-input\", \"parrain\"], [\"type\", \"password\", \"formControlName\", \"proposer\", 1, \"form-element\"], [\"class\", \"form-action\", \"style\", \"margin-top: auto;\", 4, \"ngIf\"], [\"class\", \"server-error center-text\", 4, \"ngIf\"], [\"src\", \"assets/X.svg\", 1, \"cancel-company\", 3, \"click\"], [1, \"form-action\", 2, \"margin-top\", \"auto\"], [1, \"button\", \"discover\", \"gradient\", 2, \"width\", \"250px\", 3, \"disabled\"], [1, \"server-error\", \"center-text\"]],\n  template: function RegisterForm_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelement(0, \"div\", 0);\n      i0.ɵɵtemplate(1, RegisterForm_ng_template_1_Template, 28, 3, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      i0.ɵɵtemplate(3, RegisterForm_ng_template_3_Template, 30, 13, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n    }\n\n    if (rf & 2) {\n      const _r0 = i0.ɵɵreference(2);\n\n      const _r2 = i0.ɵɵreference(4);\n\n      i0.ɵɵproperty(\"slides\", i0.ɵɵpureFunction2(2, _c0, _r0, _r2))(\"animate\", ctx.onMobile);\n    }\n  },\n  directives: [i3.SlidesDirective, i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.DefaultValueAccessor, i4.NgControlStatus, i4.FormControlName, i5.ControlErrorsDirective, i6.NgIf, i7.OptionsModel, i8.UISuggestionBox],\n  pipes: [i6.AsyncPipe],\n  styles: [\"[_ngcontent-%COMP%]:root{--notification-size: $notification-size}.page-content-with-tabs[_ngcontent-%COMP%], .mobile-view[_nghost-%COMP%]{width:100%;overflow-y:auto;overflow-x:hidden;touch-action:pan-y!important}.mobile-view[_nghost-%COMP%]{margin-top:87px;margin-top:calc(constant(safe-area-inset-top) + 87px);margin-top:calc(env(safe-area-inset-top) + 87px);height:calc(100vh - 227px - env(safe-area-inset-bottom))}.page-content-with-tabs[_ngcontent-%COMP%]{margin-top:150px;margin-top:calc(constant(safe-area-inset-top) + 150px);margin-top:calc(env(safe-area-inset-top) + 150px);margin-bottom:0;margin-bottom:calc(constant(safe-area-inset-bottom) + 0);margin-bottom:calc(env(safe-area-inset-bottom) + 0);height:calc(100vh - 220px - env(safe-area-inset-bottom))}.invert[_ngcontent-%COMP%]{filter:invert(1)}[_nghost-%COMP%]:not(.mobile-view){max-height:768px;align-self:center}.parrain[_ngcontent-%COMP%]{align-self:flex-end;max-width:50vw}.suggestion-list[_ngcontent-%COMP%]{position:absolute;z-index:10;max-height:100px;overflow:hidden auto;background:white;box-shadow:0 4px 4px #ccc}.cancel-company[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:5px;transform-origin:center;transform:scale(.7)}\"],\n  changeDetection: 0\n});\n\n__decorate([SnapshotAll('Job')], RegisterForm.prototype, \"jobs\", void 0);\n\n__decorate([SnapshotAll('Role')], RegisterForm.prototype, \"roles\", void 0);\n\n;","map":null,"metadata":{},"sourceType":"module"}