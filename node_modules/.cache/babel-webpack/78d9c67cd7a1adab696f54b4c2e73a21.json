{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { of } from \"rxjs\";\nimport { switchMap } from \"rxjs/operators\";\nimport { ExtendedProfileComponent } from \"src/app/shared/components/extended-profile/extended-profile.component\";\nimport { nameToAvailability } from \"src/models/new/data.mapper\";\nimport { DataQueries, QueryAll } from \"src/models/new/data.state\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngxs/store\";\nimport * as i2 from \"src/app/shared/components/slidemenu/slidemenu.component\";\n\nconst _c0 = function (a0) {\n  return {\n    company: a0\n  };\n};\n\nfunction SOSPageComponent_ng_container_5_ng_container_3_sos_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"sos-card\", 11);\n    i0.ɵɵlistener(\"click\", function SOSPageComponent_ng_container_5_ng_container_3_sos_card_1_Template_sos_card_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const company_r5 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(3);\n      return ctx_r7.checkCompanyProfile(company_r5);\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const company_r5 = ctx.$implicit;\n    const i_r6 = ctx.index;\n    const couple_r1 = i0.ɵɵnextContext(2).ngIf;\n    i0.ɵɵproperty(\"profile\", i0.ɵɵpureFunction1(2, _c0, company_r5))(\"availability\", couple_r1.availabilities[i_r6]);\n  }\n}\n\nfunction SOSPageComponent_ng_container_5_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, SOSPageComponent_ng_container_5_ng_container_3_sos_card_1_Template, 1, 4, \"sos-card\", 10);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const couple_r1 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", couple_r1.companies);\n  }\n}\n\nfunction SOSPageComponent_ng_container_5_mapbox_batiuni_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"mapbox-batiuni\", 12);\n    i0.ɵɵlistener(\"companyClick\", function SOSPageComponent_ng_container_5_mapbox_batiuni_4_Template_mapbox_batiuni_companyClick_0_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return ctx_r11.checkCompanyProfile($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const couple_r1 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵproperty(\"companies\", couple_r1.companies)(\"availabilities\", couple_r1.availabilities);\n  }\n}\n\nfunction SOSPageComponent_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 6);\n    i0.ɵɵelementContainerStart(2, 7);\n    i0.ɵɵtemplate(3, SOSPageComponent_ng_container_5_ng_container_3_Template, 2, 1, \"ng-container\", 8);\n    i0.ɵɵtemplate(4, SOSPageComponent_ng_container_5_mapbox_batiuni_4_Template, 1, 2, \"mapbox-batiuni\", 9);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngSwitch\", ctx_r0.activeView);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", 1);\n  }\n}\n\nexport class SOSPageComponent {\n  constructor(store, slides) {\n    this.store = store;\n    this.slides = slides;\n    this.activeView = 0;\n    this.openSOSFilterMenu = false;\n    const now = new Date().toISOString().slice(0, 10);\n    this.availableCompanies$ = this.companies$.pipe(switchMap(companies => {\n      let availableCompanies = [],\n          availabilities = [];\n\n      companyLoop: for (const company of companies) {\n        const ownAvailabilities = this.store.selectSnapshot(DataQueries.getMany('Disponibility', company.availabilities));\n\n        for (const day of ownAvailabilities) if (day.date == now) {\n          availableCompanies.push(company);\n          availabilities.push(nameToAvailability(day.nature));\n          continue companyLoop;\n        }\n      }\n\n      ;\n      console.log(availableCompanies, availabilities);\n      return of({\n        companies: availableCompanies,\n        availabilities\n      });\n    }));\n  }\n\n  getAvailableCompanies(companies) {\n    return companies;\n  }\n\n  checkCompanyProfile(company) {\n    this.slides.show(company.name, {\n      type: 'component',\n      component: ExtendedProfileComponent,\n      init: component => {\n        component.profile$ = {\n          company\n        };\n        component.showContact = true;\n      }\n    });\n  }\n\n}\n\nSOSPageComponent.ɵfac = function SOSPageComponent_Factory(t) {\n  return new (t || SOSPageComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.SlidemenuService));\n};\n\nSOSPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: SOSPageComponent,\n  selectors: [[\"sos-page\"]],\n  decls: 9,\n  vars: 5,\n  consts: [[\"name\", \"SOS\", 3, \"activeView\", \"activeViewChange\", \"filterClicked\"], [\"tab_0\", \"\"], [\"tab_1\", \"\"], [4, \"ngIf\"], [\"type\", \"view\", 3, \"open\", \"openChange\"], [\"view\", \"\"], [1, \"hosted-page\", \"space-children-margin\", \"page-content-with-tabs\"], [3, \"ngSwitch\"], [4, \"ngSwitchCase\"], [\"class\", \"space-children-margin\", 3, \"companies\", \"availabilities\", \"companyClick\", 4, \"ngSwitchCase\"], [3, \"profile\", \"availability\", \"click\", 4, \"ngFor\", \"ngForOf\"], [3, \"profile\", \"availability\", \"click\"], [1, \"space-children-margin\", 3, \"companies\", \"availabilities\", \"companyClick\"]],\n  template: function SOSPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"page-header\", 0);\n      i0.ɵɵlistener(\"activeViewChange\", function SOSPageComponent_Template_page_header_activeViewChange_0_listener($event) {\n        return ctx.activeView = $event;\n      })(\"filterClicked\", function SOSPageComponent_Template_page_header_filterClicked_0_listener() {\n        return ctx.openSOSFilterMenu = true;\n      });\n      i0.ɵɵelementStart(1, \"span\", 1);\n      i0.ɵɵtext(2, \"Vue liste\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"span\", 2);\n      i0.ɵɵtext(4, \"Carte\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(5, SOSPageComponent_ng_container_5_Template, 5, 3, \"ng-container\", 3);\n      i0.ɵɵpipe(6, \"async\");\n      i0.ɵɵelementStart(7, \"swipeup\", 4);\n      i0.ɵɵlistener(\"openChange\", function SOSPageComponent_Template_swipeup_openChange_7_listener($event) {\n        return ctx.openSOSFilterMenu = $event;\n      });\n      i0.ɵɵelement(8, \"sos-filter-form\", 5);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"activeView\", ctx.activeView);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(6, 3, ctx.availableCompanies$));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"open\", ctx.openSOSFilterMenu);\n    }\n  },\n  styles: [\"[_ngcontent-%COMP%]:root{--notification-size: $notification-size}.page-content-with-tabs[_ngcontent-%COMP%], [_nghost-%COMP%]{width:100%;overflow-y:auto;overflow-x:hidden;touch-action:pan-y!important}[_nghost-%COMP%]{display:block;height:calc(100vh - 70px - env(safe-area-inset-bottom))}.page-content-with-tabs[_ngcontent-%COMP%]{margin-top:150px;margin-top:calc(constant(safe-area-inset-top) + 150px);margin-top:calc(env(safe-area-inset-top) + 150px);margin-bottom:0;margin-bottom:calc(constant(safe-area-inset-bottom) + 0);margin-bottom:calc(env(safe-area-inset-bottom) + 0);height:calc(100vh - 220px - env(safe-area-inset-bottom))}.invert[_ngcontent-%COMP%]{filter:invert(1)}\"],\n  changeDetection: 0\n});\n\n__decorate([QueryAll('Company')], SOSPageComponent.prototype, \"companies$\", void 0);\n\n;","map":null,"metadata":{},"sourceType":"module"}