{"ast":null,"code":"import _asyncToGenerator from \"/Users/jlw/Documents/frontBatiuni/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { EventEmitter, ElementRef } from \"@angular/core\";\nimport { NG_VALUE_ACCESSOR } from \"@angular/forms\";\nimport { Camera, CameraResultType, CameraSource } from \"@capacitor/camera\";\nimport { UIAsyncAccessor } from \"src/app/shared/common/classes\";\nimport { getFileType } from \"../../common/functions\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../popup/popup.component\";\nimport * as i2 from \"../info/info.component\";\nimport * as i3 from \"../swipeup/swipeup.component\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nconst _c0 = [\"input\"];\n\nfunction FileUI_ng_container_1_input_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"input\", 13);\n    i0.ɵɵlistener(\"input\", function FileUI_ng_container_1_input_2_Template_input_input_0_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.onFilenameChange($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"formControl\", ctx_r6.editName);\n  }\n}\n\nfunction FileUI_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"span\", 10);\n    i0.ɵɵtemplate(2, FileUI_ng_container_1_input_2_Template, 1, 1, \"input\", 11);\n    i0.ɵɵelementStart(3, \"img\", 12);\n    i0.ɵɵlistener(\"click\", function FileUI_ng_container_1_Template_img_click_3_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.close();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n\n    const _r1 = i0.ɵɵreference(3);\n\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editName)(\"ngIfElse\", _r1);\n  }\n}\n\nfunction FileUI_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0);\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵtextInterpolate2(\" \", ctx_r2.filename, \" \", ctx_r2.comment, \" \");\n  }\n}\n\nfunction FileUI_label_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"T\\u00E9l\\u00E9charger la certification \", ctx_r3.filename, \"\");\n  }\n}\n\nfunction FileUI_div_12_img_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 21);\n  }\n\n  if (rf & 2) {\n    const ctx_r11 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"src\", ctx_r11.imgsrc, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction FileUI_div_12_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵprojection(1);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction FileUI_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵtemplate(1, FileUI_div_12_img_1_Template, 1, 1, \"img\", 16);\n    i0.ɵɵtemplate(2, FileUI_div_12_ng_template_2_Template, 2, 0, \"ng-template\", null, 17, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementStart(4, \"div\", 18);\n    i0.ɵɵelementStart(5, \"label\", 19);\n    i0.ɵɵtext(6, \"Date de fin de validit\\u00E9\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"input\", 20);\n    i0.ɵɵlistener(\"change\", function FileUI_div_12_Template_input_change_7_listener($event) {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.onChange({\n        origin: \"date\",\n        event: $event\n      });\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const _r12 = i0.ɵɵreference(3);\n\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.imgsrc)(\"ngIfElse\", _r12);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"value\", ctx_r5.value.expirationDate);\n  }\n}\n\nconst _c1 = [[[\"\", \"image\", \"\"]]];\nconst _c2 = [\"[image]\"];\nexport function defaultFileUIOuput(nature = '', date, name) {\n  return {\n    content: '',\n    expirationDate: date || '',\n    ext: '???',\n    name: name || 'Veuillez télécharger un document',\n    nature\n  };\n}\nexport let FileUI = /*#__PURE__*/(() => {\n  class FileUI extends UIAsyncAccessor {\n    constructor(cd, popup, info, swipeup) {\n      super(cd);\n      this.popup = popup;\n      this.info = info;\n      this.swipeup = swipeup;\n      this.filename = \"Kbis\";\n      this.filenameChange = new EventEmitter();\n      this.kill = new EventEmitter();\n      this.requestFileMenu = new EventEmitter();\n      this.editName = false;\n      this.comment = \"(Moins de 3 mois)\";\n      this.imgsrc = \"\";\n      this.showtitle = false;\n      this.includeDate = true;\n    }\n\n    ngOnInit() {\n      this.value = {\n        content: '',\n        expirationDate: '',\n        ext: '???',\n        name: 'Veuillez télécharger un document',\n        nature: this.filename\n      };\n    }\n\n    getBase64(files, index = 0) {\n      const reader = new FileReader();\n      reader.readAsDataURL(files.item(index));\n      return new Promise((res, rej) => {\n        reader.onload = () => res(reader.result);\n\n        reader.onerror = error => rej('Error: ' + error);\n      });\n    }\n\n    //override \n    getInput(e) {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        let input = e.event.target;\n\n        if (e.origin == 'date') {\n          if (!input.value) return _this.value;\n          const newDate = input.value.slice(0, 10);\n          return Object.assign(Object.assign({}, _this.value), {\n            expirationDate: newDate\n          });\n        }\n\n        if (!input.files) return _this.value;\n        const base64 = yield _this.getBase64(input.files),\n              fullname = input.files.item(0).name,\n              lastDot = fullname.lastIndexOf('.'),\n              name = fullname.slice(0, lastDot),\n              ext = fullname.slice(lastDot + 1);\n        return Object.assign(Object.assign({}, _this.value), {\n          content: base64.slice(getFileType(ext).length + 13),\n          name,\n          ext\n        });\n      })();\n    }\n\n    onFilenameChange(e) {\n      const input = e.target;\n      this.filenameChange.emit(input.value);\n    }\n\n    close() {\n      this.kill.emit();\n    }\n\n    openInput() {\n      this.inputRef.nativeElement.click();\n    }\n\n    takePhoto() {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        const photo = yield Camera.getPhoto({\n          allowEditing: false,\n          resultType: CameraResultType.Base64,\n          source: CameraSource.Photos\n        });\n        _this2.value = {\n          expirationDate: '',\n          nature: '',\n          name: photo.path || 'image du caméra',\n          ext: photo.format,\n          content: photo.base64String\n        };\n      })();\n    }\n\n    onFileInputClicked(e) {\n      var _this3 = this;\n\n      if (e.isTrusted) e.preventDefault();\n      this.swipeup.show({\n        type: 'menu',\n        hideOnClick: true,\n        items: [{\n          name: 'Supprimer un Fichier',\n          click: () => {\n            //search file having the same name and delete it\n            console.log(this._value);\n          }\n        }, {\n          name: 'Accéder au caméra',\n          click: function () {\n            var _ref = _asyncToGenerator(function* () {\n              let permissions = yield Camera.checkPermissions();\n\n              if (permissions.camera != 'granted') {\n                //try to get permission\n                permissions = yield Camera.requestPermissions({\n                  permissions: ['camera']\n                });\n                if (permissions.camera != 'granted') return _this3.info.show(\"error\", \"L'Accès au caméra n'est pas accordé\", 3000);\n\n                _this3.takePhoto();\n              } else _this3.takePhoto();\n            });\n\n            return function click() {\n              return _ref.apply(this, arguments);\n            };\n          }()\n        }, {\n          name: 'Télécharger un fichier',\n          click: () => {\n            this.openInput();\n          }\n        }, {\n          name: 'Visualiser un fichier',\n          click: () => {\n            console.log(this.value);\n            if (!this.value || !this.value.content && this.value.id == void 0) return this.info.show(\"error\", \"Aucun fichier à affichier\", 3000);\n            this.popup.openFile(this.value);\n          }\n        }]\n      });\n    }\n\n  }\n\n  FileUI.ɵfac = function FileUI_Factory(t) {\n    return new (t || FileUI)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.PopupService), i0.ɵɵdirectiveInject(i2.InfoService), i0.ɵɵdirectiveInject(i3.SwipeupService));\n  };\n\n  FileUI.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FileUI,\n    selectors: [[\"fileinput\"]],\n    viewQuery: function FileUI_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7, ElementRef);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.inputRef = _t.first);\n      }\n    },\n    inputs: {\n      filename: \"filename\",\n      editName: \"editName\",\n      comment: \"comment\",\n      imgsrc: \"imgsrc\",\n      showtitle: \"showtitle\",\n      includeDate: \"includeDate\"\n    },\n    outputs: {\n      filenameChange: \"filenameChange\",\n      kill: \"kill\",\n      requestFileMenu: \"requestFileMenu\"\n    },\n    features: [i0.ɵɵProvidersFeature([{\n      provide: NG_VALUE_ACCESSOR,\n      multi: true,\n      useExisting: FileUI\n    }]), i0.ɵɵInheritDefinitionFeature],\n    ngContentSelectors: _c2,\n    decls: 13,\n    vars: 5,\n    consts: [[4, \"ngIf\", \"ngIfElse\"], [\"simpleName\", \"\"], [\"class\", \"label-input\", \"for\", \"filename\", 4, \"ngIf\"], [1, \"file-form\", \"flex\", \"grow\"], [1, \"file-input\", \"position-relative\"], [\"type\", \"file\", 1, \"form-search\", 3, \"change\"], [\"input\", \"\"], [1, \"placeholder\", \"full-width\", \"text-ellipsis\", \"position-absolute\"], [\"src\", \"assets/Attachement.svg\", 3, \"click\"], [\"class\", \"file-date flex\", 4, \"ngIf\"], [1, \"position-relative\"], [\"type\", \"text\", \"placeholder\", \"Nom du document...\", \"class\", \"full-width form-element editName\", 3, \"formControl\", \"input\", 4, \"ngIf\", \"ngIfElse\"], [\"src\", \"assets/X.svg\", 1, \"position-absolute\", \"close-button\", 3, \"click\"], [\"type\", \"text\", \"placeholder\", \"Nom du document...\", 1, \"full-width\", \"form-element\", \"editName\", 3, \"formControl\", \"input\"], [\"for\", \"filename\", 1, \"label-input\"], [1, \"file-date\", \"flex\"], [\"class\", \"image\", 3, \"src\", 4, \"ngIf\", \"ngIfElse\"], [\"div\", \"\"], [1, \"date\", \"grow\", \"flex\", \"column\", \"center-main\"], [1, \"label-input\", \"text-emphasis\"], [\"type\", \"date\", 1, \"full-width\", 3, \"value\", \"change\"], [1, \"image\", 3, \"src\"], [1, \"image\"]],\n    template: function FileUI_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵprojectionDef(_c1);\n        i0.ɵɵelementStart(0, \"label\");\n        i0.ɵɵtemplate(1, FileUI_ng_container_1_Template, 4, 2, \"ng-container\", 0);\n        i0.ɵɵtemplate(2, FileUI_ng_template_2_Template, 1, 2, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(4, FileUI_label_4_Template, 2, 1, \"label\", 2);\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵelementStart(6, \"span\", 4);\n        i0.ɵɵelementStart(7, \"input\", 5, 6);\n        i0.ɵɵlistener(\"change\", function FileUI_Template_input_change_7_listener($event) {\n          return ctx.onChange({\n            origin: \"file\",\n            event: $event\n          });\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"span\", 7);\n        i0.ɵɵtext(10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"img\", 8);\n        i0.ɵɵlistener(\"click\", function FileUI_Template_img_click_11_listener($event) {\n          return ctx.onFileInputClicked($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(12, FileUI_div_12_Template, 8, 3, \"div\", 9);\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(3);\n\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.editName)(\"ngIfElse\", _r1);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.showtitle);\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate1(\" \", ctx.value.name, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.includeDate);\n      }\n    },\n    directives: [i4.NgIf, i5.DefaultValueAccessor, i5.NgControlStatus, i5.FormControlDirective],\n    styles: [\"[_ngcontent-%COMP%]:root{--notification-size: $notification-size}[_nghost-%COMP%]{display:block;margin-bottom:40px}label[_ngcontent-%COMP%]{color:#0c5e8d;font-weight:500;margin-bottom:10px}.label-input[_ngcontent-%COMP%]{color:#000;font-size:.9em;font-weight:200}.file-form[_ngcontent-%COMP%]{position:relative;justify-content:space-between;border-bottom:2px solid #CDCFD0}.file-form[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer;position:absolute;right:20px;bottom:5px}.file-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0}.placeholder[_ngcontent-%COMP%]{font-size:.9em;left:0;top:5px}.file-date[_ngcontent-%COMP%]{justify-content:space-around}.file-date[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-bottom:2px solid #CDCFD0;background-color:#fff}.file-date[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100px;height:100px}.date[_ngcontent-%COMP%]{text-align:left}.date[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}input[type=date][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=date][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{display:none;-webkit-appearance:none}.editName[_ngcontent-%COMP%]{font:inherit;color:inherit}.close-button[_ngcontent-%COMP%]{right:20px;bottom:5px;transform-origin:center;transform:scale(.8);filter:invert(15%) sepia(70%) saturate(5364%) hue-rotate(353deg) brightness(97%) contrast(126%)}\"],\n    changeDetection: 0\n  });\n  return FileUI;\n})();","map":null,"metadata":{},"sourceType":"module"}