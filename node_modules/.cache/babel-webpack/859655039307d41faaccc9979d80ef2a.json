{"ast":null,"code":"import _asyncToGenerator from \"/Users/jlw/Documents/frontBatiuni/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { ChangeDetectionStrategy, Component, Input } from \"@angular/core\";\nimport { Destroy$ } from \"src/app/shared/common/classes\";\nimport { DataQueries, DataState } from \"src/models/new/data.state\";\nimport { take } from \"rxjs/operators\";\nimport { ModifyDetailedPost, CreateSupervision, CreateDetailedPost, UploadImageSupervision } from \"src/models/new/user/user.actions\";\nimport { SuiviPME } from \"../suivi_pme/suivi-pme.page\";\nimport { Camera, CameraResultType, CameraSource } from \"@capacitor/camera\";\nlet SuiviChantierDate = class SuiviChantierDate extends Destroy$ {\n  constructor(cd, store, popup) {\n    super();\n    this.cd = cd;\n    this.store = store;\n    this.popup = popup;\n    this.swipeMenu = false;\n    this.swipeMenuImage = false;\n    this.view = \"PME\";\n    this.currentTaskId = null;\n\n    this._reloadMission = date => {\n      return [this.date, this.mission];\n    };\n\n    this._date = {\n      id: 0,\n      value: 0,\n      tasks: [],\n      selectedTasks: [],\n      taskWithoutDouble: [],\n      view: this.view,\n      supervisions: []\n    };\n    this._mission = null;\n  }\n\n  get date() {\n    return this._date;\n  }\n\n  set date(date) {\n    this._date = date;\n  }\n\n  get mission() {\n    return this._mission;\n  }\n\n  set mission(mission) {\n    this.view = this.store.selectSnapshot(DataState.view);\n    this._mission = mission;\n  }\n\n  get reloadMission() {\n    return this._reloadMission;\n  }\n\n  set reloadMission(callBack) {\n    this._reloadMission = callBack;\n  }\n\n  takePhoto() {\n    return _asyncToGenerator(function* () {\n      const photo = yield Camera.getPhoto({\n        allowEditing: false,\n        resultType: CameraResultType.Base64,\n        source: CameraSource.Camera\n      }); // this.store.dispatch(new ChangeProfilePicture(photo, 'image'));\n      // scr = photo.format, imageBase64 = photo.base64String, \n    })();\n  }\n\n  selectPhoto() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const photo = yield Camera.getPhoto({\n        allowEditing: false,\n        resultType: CameraResultType.Base64,\n        source: CameraSource.Photos\n      });\n\n      _this.store.dispatch(new UploadImageSupervision(photo, _this.mission.id, _this.currentTaskId));\n    })();\n  }\n\n  addDateToPost() {\n    console.log(\"get mission\", !this._mission.isClosed);\n    this.popup.openDateDialog(this.mission, this.date, this);\n    this.swipeMenu = false;\n  }\n\n  updatePage(content, missionId) {\n    if (content) {\n      this.store.dispatch(new CreateDetailedPost(missionId, content, this.date.value)).pipe(take(1)).subscribe(() => {\n        this.updatePageOnlyDate();\n      });\n    } else {\n      this.updatePageOnlyDate();\n      document.getElementById(\"accordion\");\n    }\n  }\n\n  updatePageOnlyDate() {\n    let [date, mission] = this._reloadMission(this.date);\n\n    this.date = date;\n    this.mission = mission;\n  }\n\n  validate(task) {\n    console.log(\"validate\");\n\n    if (this.view == 'ST' && !task.refused && !this.mission.isClosed) {\n      task.validated = !task.validated;\n      this.store.dispatch(new ModifyDetailedPost(task)).pipe(take(1)).subscribe(() => {\n        let control = document.getElementById(\"control_validate_\" + task.id);\n        control.src = SuiviPME.computeTaskImage(task, \"validated\");\n      });\n    }\n  }\n\n  refuse(task) {\n    if (this.view == 'ST' && !task.validated && !this.mission.isClosed) {\n      task.refused = !task.refused;\n      this.store.dispatch(new ModifyDetailedPost(task)).pipe(take(1)).subscribe(() => {\n        this.mission = this.store.selectSnapshot(DataQueries.getById('Mission', this.mission.id));\n        let control = document.getElementById(\"control_refuse_\" + task.id);\n        control.src = SuiviPME.computeTaskImage(task, \"refused\");\n      });\n    }\n  }\n\n  mainComment(task) {\n    let idInput = task ? \"input_\" + task.id : \"input_general\";\n    let input = document.getElementById(idInput);\n    this.currentTaskId = task ? task.id : null;\n\n    if (input && !this.mission.isClosed) {\n      let detailPostId = task ? task.id : null;\n      this.store.dispatch(new CreateSupervision(this.mission.id, detailPostId, null, input.value, this.date.value)).pipe(take(1)).subscribe(() => {\n        this.updatePageOnlyDate();\n      });\n    }\n  }\n\n};\n\n__decorate([Input()], SuiviChantierDate.prototype, \"date\", null);\n\n__decorate([Input()], SuiviChantierDate.prototype, \"mission\", null);\n\n__decorate([Input()], SuiviChantierDate.prototype, \"reloadMission\", null);\n\nSuiviChantierDate = __decorate([Component({\n  selector: 'suivi-chantier_date',\n  templateUrl: \"suivi_chantier_date.page.html\",\n  styleUrls: ['suivi_chantier_date.page.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})], SuiviChantierDate);\nexport { SuiviChantierDate };","map":{"version":3,"sources":["/Users/jlw/Documents/frontBatiuni/src/app/mobile/components/suivi_chantier_date/suivi_chantier_date.page.ts"],"names":["__decorate","ChangeDetectionStrategy","Component","Input","Destroy$","DataQueries","DataState","take","ModifyDetailedPost","CreateSupervision","CreateDetailedPost","UploadImageSupervision","SuiviPME","Camera","CameraResultType","CameraSource","SuiviChantierDate","constructor","cd","store","popup","swipeMenu","swipeMenuImage","view","currentTaskId","_reloadMission","date","mission","_date","id","value","tasks","selectedTasks","taskWithoutDouble","supervisions","_mission","selectSnapshot","reloadMission","callBack","takePhoto","photo","getPhoto","allowEditing","resultType","Base64","source","selectPhoto","Photos","dispatch","addDateToPost","console","log","isClosed","openDateDialog","updatePage","content","missionId","pipe","subscribe","updatePageOnlyDate","document","getElementById","validate","task","refused","validated","control","src","computeTaskImage","refuse","getById","mainComment","idInput","input","detailPostId","prototype","selector","templateUrl","styleUrls","changeDetection","OnPush"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { ChangeDetectionStrategy, Component, Input } from \"@angular/core\";\nimport { Destroy$ } from \"src/app/shared/common/classes\";\nimport { DataQueries, DataState } from \"src/models/new/data.state\";\nimport { take } from \"rxjs/operators\";\nimport { ModifyDetailedPost, CreateSupervision, CreateDetailedPost, UploadImageSupervision } from \"src/models/new/user/user.actions\";\nimport { SuiviPME } from \"../suivi_pme/suivi-pme.page\";\nimport { Camera, CameraResultType, CameraSource } from \"@capacitor/camera\";\nlet SuiviChantierDate = class SuiviChantierDate extends Destroy$ {\n    constructor(cd, store, popup) {\n        super();\n        this.cd = cd;\n        this.store = store;\n        this.popup = popup;\n        this.swipeMenu = false;\n        this.swipeMenuImage = false;\n        this.view = \"PME\";\n        this.currentTaskId = null;\n        this._reloadMission = (date) => { return [this.date, this.mission]; };\n        this._date = { id: 0, value: 0, tasks: [], selectedTasks: [], taskWithoutDouble: [], view: this.view, supervisions: [] };\n        this._mission = null;\n    }\n    get date() { return this._date; }\n    set date(date) {\n        this._date = date;\n    }\n    get mission() { return this._mission; }\n    set mission(mission) {\n        this.view = this.store.selectSnapshot(DataState.view);\n        this._mission = mission;\n    }\n    get reloadMission() { return this._reloadMission; }\n    set reloadMission(callBack) {\n        this._reloadMission = callBack;\n    }\n    async takePhoto() {\n        const photo = await Camera.getPhoto({\n            allowEditing: false,\n            resultType: CameraResultType.Base64,\n            source: CameraSource.Camera\n        });\n        // this.store.dispatch(new ChangeProfilePicture(photo, 'image'));\n        // scr = photo.format, imageBase64 = photo.base64String, \n    }\n    async selectPhoto() {\n        const photo = await Camera.getPhoto({\n            allowEditing: false,\n            resultType: CameraResultType.Base64,\n            source: CameraSource.Photos,\n        });\n        this.store.dispatch(new UploadImageSupervision(photo, this.mission.id, this.currentTaskId));\n    }\n    addDateToPost() {\n        console.log(\"get mission\", !this._mission.isClosed);\n        this.popup.openDateDialog(this.mission, this.date, this);\n        this.swipeMenu = false;\n    }\n    updatePage(content, missionId) {\n        if (content) {\n            this.store.dispatch(new CreateDetailedPost(missionId, content, this.date.value)).pipe(take(1)).subscribe(() => {\n                this.updatePageOnlyDate();\n            });\n        }\n        else {\n            this.updatePageOnlyDate();\n            document.getElementById(\"accordion\");\n        }\n    }\n    updatePageOnlyDate() {\n        let [date, mission] = this._reloadMission(this.date);\n        this.date = date;\n        this.mission = mission;\n    }\n    validate(task) {\n        console.log(\"validate\");\n        if (this.view == 'ST' && !task.refused && !this.mission.isClosed) {\n            task.validated = !task.validated;\n            this.store.dispatch(new ModifyDetailedPost(task)).pipe(take(1)).subscribe(() => {\n                let control = document.getElementById(\"control_validate_\" + task.id);\n                control.src = SuiviPME.computeTaskImage(task, \"validated\");\n            });\n        }\n    }\n    refuse(task) {\n        if (this.view == 'ST' && !task.validated && !this.mission.isClosed) {\n            task.refused = !task.refused;\n            this.store.dispatch(new ModifyDetailedPost(task)).pipe(take(1)).subscribe(() => {\n                this.mission = this.store.selectSnapshot(DataQueries.getById('Mission', this.mission.id));\n                let control = document.getElementById(\"control_refuse_\" + task.id);\n                control.src = SuiviPME.computeTaskImage(task, \"refused\");\n            });\n        }\n    }\n    mainComment(task) {\n        let idInput = task ? \"input_\" + task.id : \"input_general\";\n        let input = document.getElementById(idInput);\n        this.currentTaskId = task ? task.id : null;\n        if (input && !this.mission.isClosed) {\n            let detailPostId = task ? task.id : null;\n            this.store.dispatch(new CreateSupervision(this.mission.id, detailPostId, null, input.value, this.date.value)).pipe(take(1)).subscribe(() => {\n                this.updatePageOnlyDate();\n            });\n        }\n    }\n};\n__decorate([\n    Input()\n], SuiviChantierDate.prototype, \"date\", null);\n__decorate([\n    Input()\n], SuiviChantierDate.prototype, \"mission\", null);\n__decorate([\n    Input()\n], SuiviChantierDate.prototype, \"reloadMission\", null);\nSuiviChantierDate = __decorate([\n    Component({\n        selector: 'suivi-chantier_date',\n        templateUrl: \"suivi_chantier_date.page.html\",\n        styleUrls: ['suivi_chantier_date.page.scss'],\n        changeDetection: ChangeDetectionStrategy.OnPush\n    })\n], SuiviChantierDate);\nexport { SuiviChantierDate };\n"]},"metadata":{},"sourceType":"module"}