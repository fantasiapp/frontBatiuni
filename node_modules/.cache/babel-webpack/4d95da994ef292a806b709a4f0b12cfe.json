{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { EventEmitter } from \"@angular/core\";\nimport { NavigationEnd } from \"@angular/router\";\nimport { Select } from \"@ngxs/store\";\nimport { BehaviorSubject } from \"rxjs\";\nimport { takeUntil } from \"rxjs/operators\";\nimport { Destroy$ } from \"src/app/shared/common/classes\";\nimport { DataState } from \"src/models/new/data.state\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@ngxs/store\";\nimport * as i3 from \"../info/info.component\";\nimport * as i4 from \"@angular/common\";\n\nfunction NavigationMenu_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\", 3);\n    i0.ɵɵlistener(\"click\", function NavigationMenu_li_2_Template_li_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const index_r2 = restoredCtx.index;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return ctx_r3.changeRoute(index_r2);\n    });\n    i0.ɵɵpipe(1, \"async\");\n    i0.ɵɵelementStart(2, \"a\", 4);\n    i0.ɵɵelement(3, \"img\", 5);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const button_r1 = ctx.$implicit;\n    const index_r2 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"active\", index_r2 == i0.ɵɵpipeBind1(1, 6, ctx_r0.currentIndex));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", button_r1.src, i0.ɵɵsanitizeUrl)(\"alt\", button_r1.name)(\"title\", button_r1.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.mobileView ? \"\" : button_r1.name, \" \");\n  }\n}\n\nconst STMenu = [{\n  name: \"Home\",\n  src: \"assets/navigation/st/home.svg\",\n  route: ''\n}, {\n  name: \"Missions\",\n  src: \"assets/navigation/st/missions.svg\",\n  route: 'missions'\n}, {\n  name: \"Availibity\",\n  src: \"assets/navigation/st/availabilities.svg\",\n  route: 'availabilities'\n}, {\n  name: \"Profile\",\n  src: \"assets/navigation/st/profile.svg\",\n  route: 'profile'\n}];\nconst PMEMenu = [{\n  name: \"Home\",\n  src: \"assets/navigation/st/home.svg\",\n  route: ''\n}, {\n  name: \"Créer une Annonce\",\n  src: \"assets/navigation/pme/make.svg\",\n  route: 'make'\n}, {\n  name: \"SOS\",\n  src: \"assets/navigation/pme/sos.svg\",\n  route: 'sos'\n}, {\n  name: \"Profile\",\n  src: \"assets/navigation/st/profile.svg\",\n  route: 'profile'\n}];\nexport class NavigationMenu extends Destroy$ {\n  constructor(router, store, info) {\n    super();\n    this.router = router;\n    this.store = store;\n    this.currentIndex = new BehaviorSubject(0);\n    this.segments = [];\n    this.mobileView = window.innerWidth <= 768;\n    this.routeChange = new EventEmitter();\n    this.menu = new BehaviorSubject(this.store.selectSnapshot(DataState.view) == 'PME' ? PMEMenu : STMenu);\n    this.router.events.pipe(takeUntil(this.destroy$)).subscribe(event => {\n      if (!(event instanceof NavigationEnd)) return;\n      info.hide();\n      let menu = this.menu.getValue();\n      let segments = event.urlAfterRedirects.split('/');\n      this.segments = segments.slice(3);\n      if (segments.length < 2) this.redirectHome();\n      if (segments.length == 2) this.currentIndex.next(0);\n\n      if (segments.length > 2) {\n        let child = segments[2],\n            index = menu.findIndex(item => item.route == child);\n        this.segments = segments.slice(3); //save ids and params to use them later\n\n        if (index >= 0) {\n          this.currentIndex.next(index);\n        } else this.redirectHome();\n      }\n    });\n  }\n\n  changeRouteOnMenu(menu, index) {\n    let route = menu[index].route;\n    this.routeChange.emit(route);\n    this.router.navigate(route ? ['', 'home', route, ...this.segments] : ['', 'home']);\n    this.segments = [];\n  }\n\n  changeRoute(index) {\n    if (index == this.currentIndex.getValue()) return;\n    let menu = this.menu.getValue();\n    this.changeRouteOnMenu(menu, index);\n  }\n\n  getIndexFromUrl(url) {\n    let menu = this.menu.getValue();\n    let segments = url.split('/');\n    this.segments = segments.slice(3);\n    if (segments.length < 2) this.redirectHome();\n    if (segments.length == 2) this.currentIndex.next(0);\n\n    if (segments.length > 2) {\n      let child = segments[2],\n          index = menu.findIndex(item => item.route == child);\n      this.segments = segments.slice(3); //save ids and params to use them later\n\n      if (index >= 0) {\n        this.currentIndex.next(index);\n      } else this.redirectHome();\n    }\n  }\n\n  ngOnInit() {\n    this.navigationType$.pipe(takeUntil(this.destroy$)).subscribe(type => {\n      const nextMenu = type == 'PME' ? PMEMenu : STMenu;\n      this.menu.next(nextMenu);\n      this.getIndexFromUrl(this.router.url);\n    });\n  }\n\n  redirectHome() {\n    this.router.navigate(['', 'home']);\n  }\n\n}\n\nNavigationMenu.ɵfac = function NavigationMenu_Factory(t) {\n  return new (t || NavigationMenu)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.Store), i0.ɵɵdirectiveInject(i3.InfoService));\n};\n\nNavigationMenu.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: NavigationMenu,\n  selectors: [[\"navigation\"]],\n  outputs: {\n    routeChange: \"routeChange\"\n  },\n  features: [i0.ɵɵInheritDefinitionFeature],\n  decls: 4,\n  vars: 3,\n  consts: [[1, \"full-width\", \"flex\", \"center-cross\"], [1, \"flex\", \"row\", \"center-cross\", \"grow\"], [\"class\", \"flex center\", 3, \"active\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"flex\", \"center\", 3, \"click\"], [1, \"flex\", \"center\"], [3, \"src\", \"alt\", \"title\"]],\n  template: function NavigationMenu_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"nav\", 0);\n      i0.ɵɵelementStart(1, \"ul\", 1);\n      i0.ɵɵtemplate(2, NavigationMenu_li_2_Template, 5, 8, \"li\", 2);\n      i0.ɵɵpipe(3, \"async\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(3, 1, ctx.menu));\n    }\n  },\n  directives: [i4.NgForOf],\n  pipes: [i4.AsyncPipe],\n  styles: [\"[_ngcontent-%COMP%]:root{--notification-size: $notification-size}.page-content-with-tabs[_ngcontent-%COMP%]{width:100%;overflow-y:auto;overflow-x:hidden;touch-action:pan-y!important}.page-content-with-tabs[_ngcontent-%COMP%]{margin-top:150px;margin-top:calc(constant(safe-area-inset-top) + 150px);margin-top:calc(env(safe-area-inset-top) + 150px);margin-bottom:0;margin-bottom:calc(constant(safe-area-inset-bottom) + 0);margin-bottom:calc(env(safe-area-inset-bottom) + 0);height:calc(100vh - 220px - env(safe-area-inset-bottom))}.invert[_ngcontent-%COMP%]{filter:invert(1)}@media (max-width: 768px){[_nghost-%COMP%]{display:block;width:100%;position:fixed;bottom:0;bottom:constant(safe-area-inset-bottom);bottom:env(safe-area-inset-bottom);z-index:10;background-color:#fff}nav[_ngcontent-%COMP%]{padding:10px 30px;height:70px;box-shadow:0 -3px 3px #eee}ul[_ngcontent-%COMP%]{list-style-type:none;justify-content:space-between}li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block}li[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:50px}li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{filter:invert(12%) sepia(96%) saturate(7052%) hue-rotate(180deg) brightness(78%) contrast(111%)}}@media (min-width: 769px){nav[_ngcontent-%COMP%]{width:50%}ul[_ngcontent-%COMP%]{list-style-type:none;justify-content:space-between}li[_ngcontent-%COMP%]{padding:0 2rem;border-right:2px solid #FFFFFF}li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;white-space:nowrap;margin-right:.5rem}li[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:30px}li[_ngcontent-%COMP%]:last-child{content:\\\"\\\"!important;display:block;border-right:none!important}li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{filter:invert(12%) sepia(96%) saturate(7052%) hue-rotate(180deg) brightness(78%) contrast(111%)}li.active[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{filter:invert(12%) sepia(96%) saturate(7052%) hue-rotate(180deg) brightness(78%) contrast(111%)}}\"],\n  changeDetection: 0\n});\n\n__decorate([Select(DataState.view)], NavigationMenu.prototype, \"navigationType$\", void 0);","map":null,"metadata":{},"sourceType":"module"}